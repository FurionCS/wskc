function getWeekStartDate(){var e=new Date;var t=e.getDay()==0?7:e.getDay()-1;var r=new Date(e);r.setDate(r.getDate()-t);return r}function formatState(e){if(e==1){return"正常"}else{return"停用"}}function formatBillState(e){switch(e){case 1:return"正常";break;case 2:return"已审核";break;case 3:return"已作废";break;default:return"";break}}function formatBillStates(e){switch(e){case 1:return"未审核";break;case 2:return"审核拒绝";break;default:return"";break}}function formatTableState(e){switch(e){case 1:return"可供";break;case 2:return"预定";break;case 3:return"占用";break;case 4:return"脏台";break;case 5:return"停用";break;default:return"";break}}function formatCostItemClassCICType(e){switch(e){case 1:return"菜谱类";break;case 2:return"酒水类";break;case 3:return"套餐类";break;default:return"";break}}var formatCBBillType=function(e){switch(e){case"01":return"采购进货";break;case"012":return"采购退货";break;case"02":return"销售销货";break;case"022":return"销售退货";break;case"03":return"其它入库";break;case"04":return"其它出库";break;case"05":return"成本调整";break;case"99":return"期初入库";break;case"91":return"期初结存";break;default:return e;break}};function formatComputeType(e){switch(e){case 1:return"保留";break;case 2:return"向上取整";break;case 3:return"向下取整";break;case 4:return"四舍五入";break;default:return"";break}}function formatOverCostType(e){switch(e){case 1:return"不计算";break;case 2:return"按一段时间计算";break;default:return"";break}}function formatPriceType(e){switch(e){case 1:return"固定价";break;case 2:return"时令价";break;default:return"";break}}function formatTCType(e){switch(e){case 1:return"无提成";break;case 2:return"按固定金额提成";break;case 3:return"按人员级别提成";break;default:return"";break}}function formatCostItemState(e){switch(e){case 1:return"可售";break;case 2:return"停售";break;default:return"";break}}function formatPOSBillState(e){switch(e){case 1:return"未生成";break;case 2:return"已生成";break;default:return"";break}}function formatIOT(e){switch(e){case 1:return"入库";break;case 2:return"出库";break;default:return"";break}}function formatBillType(e){switch(e){case"01":return"餐饮账单";break;case"02":return"住宿账单";break;case"03":return"场租账单";break;default:return"";break}}function MXStrToFloat(e){if(!e){return 0}return parseFloat($.trim(e.toString()).replace(/,/g,"").replace(/ /g,""))}function InsertZeroForNumber(e){var t=parseInt(e);if(!t||t<0){return e}if(t>=0&&t<10){return"0"+t.toString()}return t.toString()}function GetFailDate(e,t,r){if(!Date||!t||!r)return"";var a=new Date(e);switch(t){case 3:a.setFullYear(a.getFullYear()+r);break;case 2:a.setMonth(a.getMonth()+r);break;case 1:a.setDate(a.getDate()+r);break;default:return"";break}var i=a.getMonth()+1;return a.getFullYear()+"-"+i+"-"+a.getDate()}var PersonClassComboTree=function(e,t,r){$(e).combotree({url:"/BaseSet/BaseRef/GetPersonClassComboTree?selectID="+t,onLoadSuccess:function(t,r){var t=$(e).combotree("tree").tree("getRoot");$(e).combotree("setValue",t.id)},onSelect:function(t){$(e).combo("setValue",t.id);if(r!=undefined){r.call()}},required:false})};function formatAreaJB(e){switch(e){case 1:return"省级";break;case 2:return"市级";break;case 3:return"县级";break;default:return"";break}}function formatLeave(e){switch(e){case 0:return"置顶";break;case 1:return"紧急";break;case 2:return"中等";break;case 3:return"一般";break;default:return"一般";break}}function formatiUnit(e){switch(e){case 1:return"元/年";break;case 2:return"元/月";break}}function GetTaskState(e){switch(e){case 1:return"等待打印";break;case 2:return"正在打印";break;case 3:return"打印完成";break;case 4:return"打印失败";break;case 5:return"任务取消";break;default:return"";break}}function formatUserType(e){switch(e){case 0:return"全部类型";break;case 1:return"监控管理员";break;case 2:return"商户";break;case 3:return"单位";break;default:return"单位";break}}function formatIsTrueOrFalse(e){switch(e){case true:return"是";break;case false:return"否";break;default:return"";break}}function formatIsState(e){switch(e){case 1:return"可用";break;case 2:return"不可用";break;default:return"";break}}function formatFType(e){switch(e){case 1:return"系统功能";break;case 2:return"服务类";break;case 99:return"其他";break;default:return"";break}}function formatValueRule(e){switch(e){case 1:return"取值规则1";break;case 2:return"取值规则2";break;default:return"";break}}function formatiRefStyle(e){switch(e){case 1:return"控件类型1";break;case 2:return"控件类型2";break;default:return"";break}}function formatiDataType(e){switch(e){case 1:return"数据类型1";break;case 2:return"数据类型2";break;default:return"";break}}function formatSNType(e){switch(e){case 1:return"不启用";break;case 2:return"启用";break;case 3:return"进出库启用";break;default:return"";break}}function formatBZQUnit(e){switch(e){case 1:return"天";break;case 2:return"月";break;case 3:return"年";break;default:return"";break}}function formatiYear(e){return e+"学年"}function ZFRowStyle(){return"background-image: url('/Images/zftag.png'); background-repeat: repeat-x;color:#6b6b6b;background-position-y: center;"}function SHRowStyle(){return"color:#0000ff"}function unique(e){e=e||[];var t={};for(var r=0;r<e.length;r++){var a=e[r];if(typeof t[a]=="undefined"){t[a]=1}}e.length=0;for(var r in t){e[e.length]=r}return e}function formatCorpPro(e){if(e==1){return"总店"}else{return"分店"}}var billBodyEdit_Price=function(e){return{type:"mxcalc",options:{DefValue:"0",isUseTable:true,onUseTableClick:function(t){var r=$("#ttbody").datagrid("getSelected");if(!r||!r.InvID){return false}var a=$('<div style="width:370px;height:200px;"></div>'),i=$(this);$('<table class="billBodyEditTable"></table>').appendTo(a);$(window).off("mousedown.billBodyEdit").on("mousedown.billBodyEdit",function(e){if(e.target){var t=$(e.target);var r=t.closest("i.mxcalc-calc-button,div.popover");if(r.length>0){}else{i.popover("hide");i.popover("destroy")}}});i.popover({html:true,animation:true,container:"body",placement:"auto",trigger:"manual",title:'<span class="billBodyEdittitle">正在查询单价...</span><i class="ace-icon fa fa-remove bigger-120 red pull-right billBodyEditclose" style="cursor: pointer;">',content:a[0].outerHTML}).off(".bs.popover").on("show.bs.popover",function(e){}).on("hide.bs.popover",function(){}).on("shown.bs.popover",function(a){$("h3.popover-title i.billBodyEditclose").bind("click",function(){i.popover("hide");i.popover("destroy")});var n=$(a.target.outerHTML).attr("aria-describedby");if(n){thisTable=$("#"+n).find("div.popover-content table.billBodyEditTable")}if(!thisTable.hasClass("easyui_dg")){thisTable.datagrid({iconCls:"icon-table",fit:true,loadMsg:"正在加载列表数据，请稍等....",pagination:false,border:true,columns:[[{title:"价格类型",field:"ItemName",width:200},{title:"价格",field:"Price",width:100,align:"right",formatter:formatMoneyWithZero}]],onDblClickRow:function(e,r){if(r){$(t).mxcalc("setValue",r.Price)}i.popover("hide")},singleSelect:true,checkOnSelect:false,selectOnCheck:false})}var o=null;var s=$("#CorpID");if(s.length>0){o=s.val()}var c=null;var u=$("#IOUID");if(u.length>0){c=u.reftext("GetValue")}var l=r.F_Unit;if(r.CorventNum==1){l=""}$.ajax({type:"POST",url:"/BaseSet/BaseRef/GetInvPrice",data:{BillType:e,InvID:r.InvID,CorpID:o,IOUID:c,InvPGID:r.InvPGID,CorventNum:r.CorventNum,F_Unit:l},dataType:"json",success:function(e){if(e.error){$.messager.alert("",e.error,"");return}var t=" ",a=" ";if(!!r.F_Unit)t="-"+r.F_Unit;if(!!r.InvPGName)a="-"+r.InvPGName;$("h3.popover-title span.billBodyEdittitle").html(r.InvName+t+a);thisTable.datagrid("loadData",e)},error:function(e){$.messager.alert("","获取单价出现错误","");return}})});i.popover("show")}}}};function initreftextWithTarget(e){switch(e){case"UserID":return{gridurl:"../User/GetUserRef",textpath:"UserName",valuepath:"UserID",showtype:"grid",title:"用户参照"};break;case"ObjID":return{gridurl:"../Object/GetObjectRef",textpath:"ObjName",valuepath:"ObjID",showtype:"grid",title:"对象参照"};break;case"VCID":return{gridurl:"../Vendor/GetVendorRef",textpath:"VCName",valuepath:"VCID",showtype:"grid",title:"供应商参照"};break;case"DepID":return{gridurl:"/BaseSet/BaseRef/GetDepartmentRef",textpath:"name",valuepath:"id",showtype:"treegrid",refwidth:600,title:"部门参照",gridparams:{CorpID:ac.CorpID}};break;case"FGDepID":return{gridurl:"/BaseSet/BaseRef/GetDepartmentRef",textpath:"name",valuepath:"id",showtype:"treegrid",refwidth:600,title:"部门参照",gridparams:{CorpID:ac.CorpID}};break;case"RStdID":return{gridurl:"/CanYin/CanYinDataRef/GetRstdCostRef",textpath:"RStdName",valuepath:"RStdID",showtype:"grid",title:"计费规则参照"};break;case"PCICIDs":return{gridurl:"/CanYin/CanYinRef/SelectList_CY_CostItemClass",textpath:"name",valuepath:"id",showtype:"treegrid",bsmnode:true,refwidth:600,title:"项目分类"};break;case"ConsuItemCIDs":return{gridurl:"/CanYin/CanYinRef/SelectList_GX_ConsumerItemClass",textpath:"name",valuepath:"id",showtype:"treegrid",bsmnode:true,refwidth:600,title:"项目分类"};break;case"CICID":return{gridurl:"/BaseSet/BaseRef/GetCostItemClassRef",textpath:"name",valuepath:"id",showtype:"treegrid",bsmnode:true,refwidth:600,title:"消费项目分类参照"};break;case"PID":return{treeurl:"/BaseSet/BaseRef/GetDepartmentTree",gridurl:"/BaseSet/BaseRef/GetPersonRef",textpath:"PName",valuepath:"PID",showtype:"treeandgrid",bsmnode:true,title:"人员参照",treeandgridTitle:"部门",treeandgridIcon:"fa-th-list",refwidth:1e3,refheight:500,treeparams:{CorpID:ac.CorpID}};break;case"FGPID":return{treeurl:"/BaseSet/BaseRef/GetDepartmentTree",gridurl:"/BaseSet/BaseRef/GetPersonRef",textpath:"PName",valuepath:"PID",showtype:"treeandgrid",bsmnode:true,title:"人员参照",treeandgridTitle:"部门",treeandgridIcon:"fa-th-list",refwidth:1e3,refheight:500,treeparams:{CorpID:ac.CorpID}};break;case"Adviser":return{treeurl:"/BaseSet/BaseRef/GetDepartmentTree",gridurl:"/BaseSet/BaseRef/GetPersonRef",textpath:"PName",valuepath:"PID",showtype:"treeandgrid",bsmnode:true,title:"人员参照",treeandgridTitle:"部门",treeandgridIcon:"fa-th-list",refwidth:1e3,refheight:500,treeparams:{CorpID:ac.CorpID}};break;case"SecUnit":return{gridurl:"/BaseSet/BaseRef/GetKC_UnitConvertRef",textpath:"SecUnit",valuepath:"UCID",showtype:"grid",bsmnode:true,title:"单位换算组参照"};break;case"ICID":return{gridurl:"/BaseSet/BaseRef/GetInvClassRef",textpath:"name",valuepath:"id",showtype:"treegrid",refwidth:600,title:"存货分类参照"};break;case"KC_Inv.ICID":return{gridurl:"/BaseSet/BaseRef/GetInvClassRef",textpath:"name",valuepath:"id",showtype:"treegrid",refwidth:600,title:"存货分类参照"};break;case"CarICID":return{gridurl:"/BaseSet/BaseRef/GetInvClassRef",textpath:"name",valuepath:"id",showtype:"treegrid",refwidth:600,title:"配件分类参照"};break;case"IOUID":if($.isIOURefLoad){return{textpath:"IOUName",valuepath:"IOUID",gridurl:"/BaseSet/JX_InOutUnit/GetJX_IOURef",usemy:true,OnRefClick:function(e){var t=e==null||e==undefined?true:false;var r=$(this);var a=$("body").iouRef("options");var i=r.reftext("options");a.ioutype=i.gridparams.IOUType;if(i.gridparams.isXSBill){a.isXSBill=i.gridparams.isXSBill}if(t){$("body").iouRef("showCheck")}else{$("body").iouRef("hideCheck")}$("body").iouRef("open",function(e){if(!!e){r.reftext("SetItem",e)}else{r.reftext("SetItem",null)}})}};break}else{return{gridurl:"/BaseSet/BaseRef/GetJX_InOutUnitRef",gridparams:{IOUType:-1},textpath:"IOUName",valuepath:"IOUID",showtype:"grid",bsmnode:true,title:"往来单位参照"};break}case"IOUCID":return{gridurl:"/BaseSet/BaseRef/GetInOutUnitClassRef",textpath:"name",valuepath:"id",showtype:"treegrid",bsmnode:true,refwidth:600,title:"单位类别",gridparams:{IOUType:-1}};break;case"UAID":return{gridurl:"/BaseSet/BaseRef/GetUnitAreaRef",textpath:"name",valuepath:"id",showtype:"treegrid",refwidth:600,title:"地区参照"};break;case"InvID":return{textpath:"InvName",valuepath:"InvID",gridurl:"/BaseSet/KC_Inv/GetKC_InvRef",usemy:true,OnRefClick:function(e){var t=e==null||e==undefined?true:false;$.quickAdd.invConfig.selector=this;if(t){$("body").invRef("showCheck")}else{$("body").invRef("hideCheck")}$("body").invRef("open",function(e){if(!!e){if($.isArray(e)){if(e.length==0){$($.quickAdd.invConfig.selector).reftext("SetItem",null)}else if(e.length==1){$($.quickAdd.invConfig.selector).reftext("SetItem",e[0])}else{$($.quickAdd.invConfig.selector).reftext("SetItems",e)}}else{$($.quickAdd.invConfig.selector).reftext("SetItem",e)}}});$("body").invRef({getAttrOpt:function(){var e=$.data($.quickAdd.invConfig.selector,"reftext").options;return{CorpID:e.CorpID,IOUID:e.IOUID,isQTSY:e.isQTSY}}})}};break;case"CIID":return{textpath:"CIName",valuepath:"CIID",gridurl:"/CanYin/CYItemAction/GetCY_CostItemClass",usemy:true,OnRefClick:function(e){var t=this;var r=e==null||e==undefined?true:false;if(r){$("body").CYItemRef("showCheck")}else{$("body").CYItemRef("hideCheck")}$("body").CYItemRef("open",function(e){if(!!e){if($.isArray(e)){if(e.length==0){$(t).reftext("SetItem",null)}else if(e.length==1){$(t).reftext("SetItem",e[0])}else{$(t).reftext("SetItems",e)}}else{$(t).reftext("SetItem",e)}}})}};break;case"SCIID":return{textpath:"CIName",valuepath:"CIID",gridurl:"/CanYin/CYItemAction/GetCY_CostItemClass",usemy:true,OnRefClick:function(e){var t=this;var r=e==null||e==undefined?true:false;if(r){$("body").CYItemRef("showCheck")}else{$("body").CYItemRef("hideCheck")}$("body").CYItemRef("open",function(e){if(!!e){if($.isArray(e)){if(e.length==0){$(t).reftext("SetItem",null)}else if(e.length==1){$(t).reftext("SetItem",e[0])}else{$(t).reftext("SetItems",e)}}else{$(t).reftext("SetItem",e)}}})}};break;case"WIID":return{textpath:"WIName",valuepath:"WIID",gridurl:"/Car/CarRef/GetWIIDWorkRef",usemy:true,OnRefClick:function(e){var t=this;var r=e==null||e==undefined?true:false;if(r){$("body").CarWorkItemRef("showCheck")}else{$("body").CarWorkItemRef("hideCheck")}$("body").CarWorkItemRef("open",function(e){if(!!e){if($.isArray(e)){if(e.length==0){$(t).reftext("SetItem",null)}else if(e.length==1){$(t).reftext("SetItem",e[0])}else{$(t).reftext("SetItems",e)}}else{$(t).reftext("SetItem",e)}}})}};break;case"InvIDs":return{textpath:"InvName",valuepath:"InvID",gridurl:"/Car/CarRef/GetCarInvRef",usemy:true,OnRefClick:function(e){var t=this;var r=e==null||e==undefined?true:false;if(r){$("body").CarInvItemRef("showCheck")}else{$("body").CarInvItemRef("hideCheck")}$("body").CarInvItemRef("open",function(e){if(!!e){if($.isArray(e)){if(e.length==0){$(t).reftext("SetItem",null)}else if(e.length==1){$(t).reftext("SetItems",e[0])}else{$(t).reftext("SetItems",e)}}else{$(t).reftext("SetItem",e)}}})}};break;case"PiCiID":return{gridurl:"/BaseSet/BaseRef/GetKC_PiCiRef",textpath:"PCCode",valuepath:"PCID",showtype:"grid",bsmnode:true,refwidth:600,title:"批次参照",isCanCustom:true};break;case"PPCID":if($(this).attr("bsmnode")=="true"){$("#PPCID").reftext({inittag:"PCID",bsmnode:true,initui:initreftextWithTarget})}else{$("#PPCID").reftext({inittag:"PCID",bsmnode:false,initui:initreftextWithTarget})}break;case"PCID":return{gridurl:"/BaseSet/BaseRef/GetPersonClassRef",textpath:"name",valuepath:"id",showtype:"treegrid",refwidth:600,title:"人员类别参照"};break;case"AIID":case"FYAIID":case"JSTID":return{gridurl:"/CaiWu/CaiWuRef/GetAccItemRef",textpath:"name",valuepath:"id",showtype:"treegrid",bsmnode:true,refwidth:600,title:"会计科目参照"};break;case"Remark":return{gridurl:"/BaseSet/BaseRef/GetSummaryRef",textpath:"cName",valuepath:"cName",showtype:"grid",bsmnode:true,title:"常用词汇参照",isCanCustom:true};break;case"LICode":return{gridurl:"/BaseSet/BaseRef/GetCP_LimitItemRef",textpath:"LIName",valuepath:"LICode",showtype:"grid",bsmnode:true,title:"限制参数参照"};break;case"MXLICode":return{gridurl:"/BaseSet/BaseRef/GetCP_MXLimitItemRef",textpath:"MXLIName",valuepath:"MXLICode",showtype:"grid",bsmnode:true,title:"平台限制参数参照"};break;case"QX_VMID":return{gridurl:"/Car/CarRef/VehicleModelRef",textpath:"VMName",valuepath:"VMID",showtype:"grid",title:"车型参照"};break;case"VID":return{gridurl:"/Car/CarRef/VehicleRef",textpath:"IOUName",valuepath:"VID",showtype:"grid",title:"车辆档案参照"};break;case"WCID":return{gridurl:"/Car/CarRef/GetWorkClassRef",textpath:"name",valuepath:"id",showtype:"treegrid",title:"服务分类"};break;case"VMID":return{gridurl:"/HuiYuan/HuiYuanRef/V_MemberRef",textpath:"VMCode",valuepath:"VMID",showtype:"grid",title:"会员参照"};break;case"XZID":return{gridurl:"/Car/CarRef/GX_XZItems",textpath:"XZName",valuepath:"XZID",showtype:"grid",title:"险种参照"};break;default:return{};break}}function initreftextWithTarget_Two(e){return initreftextWithTarget(e)}function SetColHeadCss(e){$('tr[class="datagrid-header-row"]:last()').find(e).find("div span").attr("style","color:#0000FF")}function BarCodekeyUp(e,t){if(formStatus=="read"){return}var r=window.event?true:false;var a;var i;if(r){a=window.event.keyCode;i=window.event}else{a=e.which;i=e}if(a==13){var n=t.value;t.value="";if(r){event.returnValue=false}else{i.which=0}var o=false}}function dyniframesize(id){var pTar=null;if(document.getElementById){pTar=document.getElementById(id)}else{eval("pTar = "+id+";")}if(pTar&&!window.opera){pTar.style.display="block";if(pTar.contentDocument&&pTar.contentDocument.body.offsetHeight){pTar.height=pTar.contentDocument.body.offsetHeight+20;pTar.width=pTar.contentDocument.body.scrollWidth+20}else if(pTar.Document&&pTar.Document.body.scrollHeight){pTar.height=pTar.Document.body.scrollHeight;pTar.width=pTar.Document.body.scrollWidth}}}(function(e){e.fn.BillPeriodPay=function(r){r=r||{};return this.each(function(){var a=e.data(this,"BillPeriodPay");if(a){e.extend(a.options,r)}else{a=e.data(this,"BillPeriodPay",{options:e.extend({},e.fn.BillPeriodPay.defaults,r)})}t(this)})};e.fn.BillPeriodPay.defaults={formStatus:"",BillID:"",BillDate:"1949-10-01",TMoney:0,height:450,width:600,getData:function(e){},onClose:function(e){}};function t(t){var r=e.data(t,"BillPeriodPay").options;var a=r.formStatus;var i=r.BillID;var n=r.BillDate;var o=r.objid;var s=r.TMoney;if(!i){i=null}if(!s){s=null}var c=r.height;var u='<iframe id="BillPeriodPay_dialogform_frame" objid='+o+'  scrolling="auto" frameborder="0" src="/Bill/BillOper/BillPeriodPay?formStatus='+a+"&BillID="+i+"&TMoney="+s+"&BillDate="+n+'" style="width:100%;" onload="javascript:dyniframesize(\'BillPeriodPay_dialogform_frame\');" ></iframe>';e(t).drawformcard(1);e(t).bs_dialog({width:"lg",title:' <h5 style="margin-top:5px;margin-bottom:5px;"><i class="ace-icon fa fa-credit-card fa-2x green" style="margin-right:5px;"></i>分期付款</h5>',buttons:[{dom:'<button class="btn btn-sm btn-warning"><i class="ace-icon fa fa-remove bigger-110"></i><span class="bigger-110">取消</span></button>',handler:function(){r.onClose.call(t);e(t).bs_dialog("close")}},{dom:'<button class="btn btn-sm btn-primary"><i class="ace-icon fa fa-check bigger-110"></i><span class="bigger-110">确定</span></button>',handler:function(){e("#BillPeriodPay_dialogform_frame")[0].contentWindow.GetData(function(a){r.getData.call(t,a);e(t).bs_dialog("close")})}}],onClose:function(){r.onClose.call(t)},onShow:function(){e(t).hideLoading()}});e(t).html('<div class="row"><div class="col-sm-12">'+u+"</div></div>");e(t).showLoading("");e(t).bs_dialog("open")}})(jQuery);(function(e){e.fn.ShowInvRef=function(r){r=r||{};return this.each(function(){var a=e.data(this,"ShowInvRef");if(a){e.extend(a.options,r)}else{a=e.data(this,"ShowInvRef",{options:e.extend({},e.fn.ShowInvRef.defaults,r)})}t(this)})};e.fn.ShowInvRef.defaults={title:"存货档案",serchparam:"",ischeck:true,width:500,getData:function(e){},onClose:function(e){}};function t(t){var r=e.data(t,"ShowInvRef").options;var a=r.serchparam;var i=r.ischeck;var n=e(".uigrid-parentdiv").height();var o="/BaseSet/KC_Inv/KC_InvRef?serchparam=' + serchparam + '&ischeck=' + ischeck + '";var s='<iframe id="ShowInvRef_dialogform_frame" objid="0107"  scrolling="no" frameborder="0" src="'+o+'" style="width:100%;height:99%;"></iframe>';if(e("#ShowInvRef_dialogform_frame").length<=0){e(t).dialog({title:r.title,width:r.width,height:n,closed:true,cache:false,loadingMessage:"正在加载...",content:s,modal:true,shadow:true,buttons:[{text:"确定",iconCls:"icon-ok",handler:function(){e("#ShowInvRef_dialogform_frame")[0].contentWindow.GetData(function(a){r.getData.call(t,a);e(t).dialog("close",true)})}},{text:"关闭",iconCls:"icon-cancel",handler:function(){r.onClose.call(t);e(t).dialog("close",true)}}],onClose:function(){r.onClose.call(t)}})}e(t).dialog("open")}})(jQuery);function CurentTime(){var e=new Date;var t=e.getFullYear();var r=e.getMonth()+1;var a=e.getDate();var i=e.getHours();var n=e.getMinutes();var o=t+"-";if(r<10)o+="0";o+=r+"-";if(a<10)o+="0";o+=a;return o}function CalculateBodyEdit(e,t,r){if(!t.InvID){return t}if(t.F_Quantity<0){return t}for(var a in t){if(a.indexOf("Quantity")>=0||a.indexOf("Money")>=0||a.indexOf("Price")>=0||a.indexOf("Percent")>=0){t[a]=parseFloat(t[a])}}for(var a in r){switch(a){case"F_Quantity":case"CorventNum":t.F_DisAPrice=t.F_Price*(t.DisPercent/100);t.TotalMoney=t.F_Quantity*t.F_DisAPrice;t.NoTaxMoney=t.TotalMoney/(1+t.TaxPercent/100);t.TaxMoney=t.TotalMoney-t.NoTaxMoney;if(t.F_Quantity>0){t.F_NoTaxPrice=t.NoTaxMoney/t.F_Quantity}t.DisBMoney=t.F_Quantity*t.F_Price;t.DisMoney=t.DisBMoney-t.TotalMoney;t.ClacField=1;break;case"F_Price":t.DisBMoney=t.F_Quantity*t.F_Price;t.F_DisAPrice=t.F_Price*(t.DisPercent/100);t.TotalMoney=t.F_Quantity*t.F_DisAPrice;t.NoTaxMoney=t.TotalMoney/(1+t.TaxPercent/100);t.TaxMoney=t.TotalMoney-t.NoTaxMoney;if(t.F_Quantity>0){t.F_NoTaxPrice=t.NoTaxMoney/t.F_Quantity}t.DisMoney=t.DisBMoney-t.TotalMoney;t.ClacField=2;break;case"F_DisAPrice":t.ClacField=3;break;case"F_NoTaxPrice":t.NoTaxMoney=t.F_Quantity*t.F_NoTaxPrice;t.TaxMoney=t.NoTaxMoney*(t.TaxPercent/100);t.TotalMoney=t.NoTaxMoney+t.TaxMoney;if(t.F_Quantity>0){t.F_DisAPrice=t.TotalMoney/t.F_Quantity}if(t.DisPercent==0){t.F_Price=0}else{t.F_Price=t.F_DisAPrice/(t.DisPercent/100)}t.DisBMoney=t.F_Quantity*t.F_Price;t.DisMoney=t.DisBMoney-t.TotalMoney;t.ClacField=4;break;case"DisBMoney":if(t.F_Quantity>0){t.F_Price=t.DisBMoney/t.F_Quantity}t.DisMoney=t.DisBMoney*(1-t.DisPercent/100);t.TotalMoney=t.DisBMoney-t.DisMoney;if(t.F_Quantity>0){t.F_DisAPrice=t.TotalMoney/t.F_Quantity}t.NoTaxMoney=t.TotalMoney/(1+t.TaxPercent/100);t.TaxMoney=t.TotalMoney-t.NoTaxMoney;if(t.F_Quantity>0){t.F_NoTaxPrice=t.NoTaxMoney/t.F_Quantity}t.ClacField=5;break;case"DisPercent":t.DisMoney=t.DisBMoney*(1-t.DisPercent/100);t.TotalMoney=t.DisBMoney-t.DisMoney;if(t.F_Quantity>0){t.F_DisAPrice=t.TotalMoney/t.F_Quantity}t.NoTaxMoney=t.TotalMoney/(1+t.TaxPercent/100);t.TaxMoney=t.TotalMoney-t.NoTaxMoney;if(t.F_Quantity>0){t.F_NoTaxPrice=t.NoTaxMoney/t.F_Quantity}t.ClacField=6;break;case"DisMoney":if(t.DisBMoney>0){t.DisPercent=(1-t.DisMoney/t.DisBMoney)*100}t.TotalMoney=t.DisBMoney-t.DisMoney;if(t.F_Quantity>0){t.F_DisAPrice=t.TotalMoney/t.F_Quantity}t.NoTaxMoney=t.TotalMoney/(1+t.TaxPercent/100);t.TaxMoney=t.TotalMoney-t.NoTaxMoney;if(t.F_Quantity>0){t.F_NoTaxPrice=t.NoTaxMoney/t.F_Quantity}t.ClacField=7;break;case"NoTaxMoney":t.NoTaxMoney=parseFloat(t.NoTaxMoney);t.TaxMoney=t.NoTaxMoney*(t.TaxPercent/100);t.TotalMoney=t.NoTaxMoney+t.TaxMoney;if(t.F_Quantity>0){t.F_DisAPrice=t.TotalMoney/t.F_Quantity;t.F_NoTaxPrice=t.NoTaxMoney/t.F_Quantity}t.F_Price=t.F_DisAPrice/(t.DisPercent/100);t.DisBMoney=t.F_Quantity*t.F_Price;t.DisMoney=t.DisBMoney*(1-t.DisPercent/100);t.ClacField=8;break;case"TotalMoney":t.NoTaxMoney=t.TotalMoney/(1+t.TaxPercent/100);t.TaxMoney=t.TotalMoney-t.NoTaxMoney;if(t.F_Quantity>0){t.F_DisAPrice=t.TotalMoney/t.F_Quantity;t.F_NoTaxPrice=t.NoTaxMoney/t.F_Quantity}t.F_Price=t.F_DisAPrice/(t.DisPercent/100);t.DisBMoney=t.F_Quantity*t.F_Price;t.DisMoney=t.DisBMoney*(1-t.DisPercent/100);t.ClacField=9;break;case"TaxPercent":t.TaxMoney=t.TotalMoney/(1+t.TaxPercent/100)*(t.TaxPercent/100);t.NoTaxMoney=t.TotalMoney-t.TaxMoney;if(t.F_Quantity>0){t.F_NoTaxPrice=t.NoTaxMoney/t.F_Quantity}t.ClacField=10;break;case"TaxMoney":t.ClacField=11;break;case"Quantity":t.DisAPrice=t.Price*(t.DisPercent/100);t.TotalMoney=t.Quantity*t.DisAPrice;t.NoTaxMoney=t.TotalMoney/(1+t.TaxPercent/100);t.TaxMoney=t.TotalMoney-t.NoTaxMoney;if(t.Quantity>0){t.NoTaxPrice=t.NoTaxMoney/t.Quantity}t.DisBMoney=t.Quantity*t.Price;t.DisMoney=t.DisBMoney-t.TotalMoney;try{if(t.isCUFD==undefined)GetUnits(t)}catch(i){}if(t.isCUFD==true&&t.F_Quantity>0)t.ClacField=21;else t.ClacField=12;break;case"Price":t.DisBMoney=t.Quantity*t.Price;t.DisAPrice=t.Price*(t.DisPercent/100);t.TotalMoney=t.Quantity*t.DisAPrice;t.NoTaxMoney=t.TotalMoney/(1+t.TaxPercent/100);t.TaxMoney=t.TotalMoney-t.NoTaxMoney;if(t.Quantity>0){t.NoTaxPrice=t.NoTaxMoney/t.Quantity}t.DisMoney=t.DisBMoney-t.TotalMoney;t.ClacField=13;break;case"DisAPrice":t.ClacField=14;break;case"NoTaxPrice":t.NoTaxMoney=t.Quantity*t.NoTaxPrice;t.TaxMoney=t.NoTaxMoney*(t.TaxPercent/100);t.TotalMoney=t.NoTaxMoney+t.TaxMoney;if(t.Quantity>0){t.DisAPrice=t.TotalMoney/t.Quantity}if(t.DisPercent==0){t.Price=0}else{t.Price=t.DisAPrice/(t.DisPercent/100)}t.DisBMoney=t.Quantity*t.Price;t.DisMoney=t.DisBMoney-t.TotalMoney;t.ClacField=15;break;default:}if(t.ClacField==12||t.ClacField==13||t.ClacField==14||t.ClacField==15||t.ClacField==21){if(t.ClacField==21)t.CorventNum=(t.Quantity/t.F_Quantity).round(4);else t.F_Quantity=t.CorventNum==0?0:(t.Quantity/t.CorventNum).round(4);t.F_Price=(t.Price*t.CorventNum).round(DefPriceDigits);t.F_DisAPrice=(t.DisAPrice*t.CorventNum).round(DefPriceDigits);t.F_NoTaxPrice=(t.NoTaxPrice*t.CorventNum).round(DefPriceDigits)}else{t.Quantity=(t.F_Quantity*t.CorventNum).round(4);t.Price=t.CorventNum==0?0:(t.F_Price/t.CorventNum).round(DefPriceDigits);t.DisAPrice=t.CorventNum==0?0:(t.F_DisAPrice/t.CorventNum).round(DefPriceDigits);t.NoTaxPrice=t.CorventNum==0?0:(t.F_NoTaxPrice/t.CorventNum).round(DefPriceDigits)}if(a!="TCMoney"){if(t.TCType&&t.TCMoneys){if(t.TCType==2){t.TCMoney=t.TCMoneys*t.Quantity}else if(t.TCType==3){t.TCMoney=t.TotalMoney*(t.TCMoneys/100)}}}}if(t.Price){t.Price=t.Price.round(DefPriceDigits)}if(t.DisAPrice){t.DisAPrice=t.DisAPrice.round(DefPriceDigits)}if(t.NoTaxPrice){t.NoTaxPrice=t.NoTaxPrice.round(DefPriceDigits)}if(t.F_Price){t.F_Price=t.F_Price.round(DefPriceDigits)}if(t.F_DisAPrice){t.F_DisAPrice=t.F_DisAPrice.round(DefPriceDigits)}if(t.F_NoTaxPrice){t.F_NoTaxPrice=t.F_NoTaxPrice.round(DefPriceDigits)}if(t.DisBMoney){t.DisBMoney=t.DisBMoney.round(2)}if(t.DisMoney){t.DisMoney=t.DisMoney.round(2)}if(t.NoTaxMoney){t.NoTaxMoney=t.NoTaxMoney.round(2)}if(t.TotalMoney){t.TotalMoney=t.TotalMoney.round(2)}if(t.TaxMoney){t.TaxMoney=t.TaxMoney.round(2)}if(t.TCMoney){t.TCMoney=t.TCMoney.round(2)}CalculateBodyEditForUnit(t);return t}function CalculateBodyEditForUnit(e){}function initinputWithTarget(){if(!this){return}switch(this.name){case"F_Defined1":case"F_Defined2":$(this).mxcalc({isShowCalc:false});break;case"TaxPercent":$(this).mxcalc({DefValue:"0",min:0,max:100,isShowCalc:false});break;case"DisPercent":$(this).mxcalc({DefValue:"100",min:0,max:100,isShowCalc:false});break;case"YFMoney":$(this).mxcalc({precision:2,onChange:function(e){var t=e.txtvalue.val().replace(/,/g,"");if(t==null||t==""){t="0.00"}var r=(parseFloat($("#TotalMoney").val().replace(/,/g,""))-parseFloat(t)).toFixed(2);$("#SWFMoney").val(r)}});break;case"YSMoney":$(this).mxcalc({precision:2,onChange:function(e){var t=e.txtvalue.val().replace(/,/g,"");if(t==null||t==""){t="0.00"}var r=(parseFloat($("#TotalMoney").val().replace(/,/g,""))-parseFloat(t)).toFixed(2);$("#SQKMoney").val(r)}});break;case"CreditMoney":$(this).mxcalc({precision:2,DefValue:"0",min:0,isShowCalc:false});break;case"CKInPrice":case"CKSalePrice":case"PosPrice":case"CKCostPrice":case"Weight":$(this).mxcalc({});break;case"Birthday":$(this).mxdate({type:"day"});break;case"BillDate":$(this).mxdate({type:"day"});break;case"YWDepID":case"PDepID":case"DepID":var e=$(this),t=true;if($(this).attr("bsmnode")=="false"){t=false}$(this).reftext({inittag:"DepID",bsmnode:t,initui:initreftextWithTarget,OnSelectItem:function(t){if(e.attr("SetDep")=="true"){if(t){SetDepForPID(t)}else{SetDepForPID(null)}}if(e.attr("SetYWDep")=="true"){if(t){SetDepForPID_YW(t)}else{SetDepForPID_YW(null)}}}});break;case"DGPID":case"ByPID":case"TrPID":case"YWPID":case"PID":var e=$(this);$(this).reftext({inittag:"PID",initui:initreftextWithTarget,textpath:"PName",valuepath:"PID",OnSelectItem:function(t){if(t&&e.attr("SetDep")=="true"){SetDep(t)}if(t&&e.attr("SetYWDep")=="true"){SetDep_YW(t)}}});break;case"Adviser":var e=$(this);$(this).reftext({inittag:"Adviser",initui:initreftextWithTarget,textpath:"PName",valuepath:"PID",OnSelectItem:function(t){if(t&&e.attr("SetDep")=="true"){SetDep(t)}}});break;case"BarCode":if($(this).attr("servertag")=="true"){$(this).codesearch({url:"/BarCode/GetInvInfo",onSuccess:function(e){InvCodekeyUpSuccess(e)},onError:function(e){InvCodekeyUpError(e)}});break}$(this).codesearch({onSuccess:function(e){InvCodekeyUpSuccess(e)},getParam:function(){try{return GetCodeSearchParam()}catch(e){return{}}}});break;case"DHTime":$(this).mxdate({});break;case"CICID":case"pCICID":$(this).reftext({inittag:"CICID",initui:initreftextWithTarget});break;case"IOUID":var e=$(this);if($(this).attr("IOUType")==null){$(this).reftext({inittag:"IOUID",gridparams:{IOUType:-1},initui:initreftextWithTarget,OnSelectItem:function(t){if(e.attr("SetFG")=="true"){if(t){SetFG(t)}else{SetFG(null)}}}})}else{var r={IOUType:$(this).attr("IOUType")};if($(this).attr("isXSBill")=="true"){r=$.extend({isXSBill:true},r)}$(this).reftext({inittag:"IOUID",gridparams:r,initui:initreftextWithTarget,OnSelectItem:function(t){if(e.attr("SetFG")=="true"){if(t){SetFG(t)}else{SetFG(null)}}}})}break;case"PIOUCID":$(this).reftext({inittag:"IOUCID",initui:initreftextWithTarget});break;case"IOUCID":$(this).reftext({inittag:"IOUCID",initui:initreftextWithTarget});break;case"PUAID":case"UAID":if($(this).attr("bsmnode")=="false"){$(this).reftext({inittag:"UAID",bsmnode:false,initui:initreftextWithTarget})}else{$(this).reftext({inittag:"UAID",bsmnode:true,initui:initreftextWithTarget})}break;case"SIOUType":$(this).combobox({editable:false,width:150,onSelect:function(e){if(bLoaded){SearchData(true)}}});break;case"PICID":case"ICID":var a="ICID";if($(this).attr("car"))a="CarICID";if($(this).attr("bsmnode")=="false"){$(this).reftext({inittag:a,bsmnode:false,initui:initreftextWithTarget})}else{$(this).reftext({inittag:a,bsmnode:true,initui:initreftextWithTarget})}break;case"CarPICID":case"CarICID":if($(this).attr("bsmnode")=="false"){$(this).reftext({inittag:"CarICID",bsmnode:false,initui:initreftextWithTarget})}else{$(this).reftext({inittag:"CarICID",bsmnode:true,initui:initreftextWithTarget})}break;case"InvID":$(this).invRef({});break;case"STTID":$(this).reftext({inittag:"STTID",initui:initreftextWithTarget});break;case"PCID":var i=this;var n=null;var o=null;if($.data(this,"beforeSelect")!=null){o=$.data(this,"beforeSelect").fn}$(i).combotree({url:"/BaseSet/BaseRef/GetPersonClassComboTree?selectID="+n,onBeforeSelect:function(e){var t=true;if(o!=null){if(!o(e)){t=false}}return t},required:false});break;case"VTID":var i=this;var n=null;var s=function(){};$(i).combotree({url:"/HuiYuan/VMember/GetDataForTree",onLoadSuccess:function(e,t){var e=$(i).combotree("tree").tree("getRoot")},onSelect:function(e){$(i).combo("setValue",e.id);if(s!=undefined){s.call()}},required:false});break;case"PPCID":if($(this).attr("bsmnode")=="true"){$("#PPCID").reftext({inittag:"PCID",bsmnode:true,initui:initreftextWithTarget})}else{$("#PPCID").reftext({inittag:"PCID",bsmnode:false,initui:initreftextWithTarget})}break;case"UnitRemark":case"Remark":if($(this).attr("isRef")==null){$(this).reftext({inittag:"Remark",initui:initreftextWithTarget})}break;case"PAIID":case"AIID":var c="";switch($(this).attr("AITypes")){case"[1]":c="现金参照";break;case"[2]":c="银行参照";break;case"[1,2]":c="现金银行参照";break;case"[3]":c="收入参照";break;case"[4]":c="支出参照";break;case"[3,4]":c="收支类别参照";break;case"[5]":c="固定资产参照";break;default:}$(this).reftext({inittag:"AIID",initui:initreftextWithTarget,gridparams:{AITypes:$(this).attr("AITypes")},title:c});break;case"WCPID":$(this).reftext({inittag:"WCID",bsmnode:true,initui:initreftextWithTarget});break;case"VMID":$(this).reftext({inittag:"VMID",initui:initreftextWithTarget});break;case"XZID":$(this).reftext({inittag:"XZID",initui:initreftextWithTarget});break;default:}}(function(e){e.extend({getDatagridCellInput:function(t,r,a){var i;if(undefined===t||undefined===r||undefined===a){return}i=e("#datagrid-row-r"+t+"-2-"+r+' td[field="'+a+'"] table input[type="text"]');
return i}})})(jQuery);(function(e){e.extend({getCursorPosition:function(e){var t=document.getElementById(e);try{if(!t){return}var r=-1;if(t.selectionStart){r=t.selectionStart}else{var a=document.selection.createRange();a.moveStart("character",t.valu.length);r=a.text.length}}catch(i){return 0}return r}})})(jQuery);(function(e){e.extend({setCursorPosition:function(e,t){var r=document.getElementById(e);try{if(r.setSelectionRange){r.focus();r.setSelectionRange(t,t)}else if(r.createTextRange){var a=r.createTextRange();a.collapse(true);a.moveEnd("character",t);a.moveStart("character",t);a.select()}}catch(i){throw new Error("设置光标位置时出错了。")}}})})(jQuery);(function(e){e.extend({disabledImageDrag:function(){var e=document.images;if(e&&e.length>0){for(var t=0;t<e.length;t++){e[t].ondragstart=function(){return false}}}},tip:function(t,r,a){if(typeof t==="boolean"){var i=t?"success":"error";var n=t?"#0094ff":"#eb4f38";var o=document.getElementById("successTip2014-8-27");if(o&&o.getAttribute("id")){i=t?"success":"error";n=t?"#0376e4":"#eb4f38";o.innerHTML='<img id="successTipImg2014-8-27" src="../../Images/'+i+'.png" /><br />'+r+"";o.style="border-radius:10px;width:128px;height:126px;background-color:"+n+";font-size:17px;text-align:center;"+"color:white;position:absolute;top:-126px;margin-left:-64px;left:50%;z-index:1000000;";o.style.cssText="border-radius:10px;width:128px;height:126px;background-color:"+n+";font-size:17px;text-align:center;"+"color:white;position:absolute;top:-126px;margin-left:-64px;left:50%;z-index:1000000;";document.getElementById("successTipImg2014-8-27").ondragstart=function(){return false}}else{o=document.createElement("div");o.innerHTML='<img id="successTipImg2014-8-27" src="../../Images/'+i+'.png" /><br />'+r+"";o.setAttribute("id","successTip2014-8-27");o.style="border-radius:10px;width:128px;height:126px;background-color:"+n+";font-size:17px;text-align:center;"+"color:white;position:absolute;top:-126px;margin-left:-64px;left:50%;z-index:1000000;";o.style.cssText="border-radius:10px;width:128px;height:126px;background-color:"+n+";font-size:17px;text-align:center;"+"color:white;position:absolute;top:-126px;margin-left:-64px;left:50%;z-index:1000000;";document.body.appendChild(o);document.getElementById("successTipImg2014-8-27").ondragstart=function(){return false}}var s=function(){e("#successTip2014-8-27").animate({top:"-126"},200)};e("#successTip2014-8-27").animate({top:"0"},500);window.setTimeout(s(),a)}}})})(jQuery);(function(e){e.extend({browserName:function(){try{var e=navigator.userAgent.toLowerCase();if(/firefox\/([\d.]+)/.test(e)){return"firefox"}else if(/chrome\/([\d.]+)/.test(e)){return"chrome"}else if(/opera.([\d.]+)/.test(e)){return"opera"}else{return"ie"}}catch(t){throw new Error("mxmvc.main.js发生异常")}}})})(jQuery);(function(e){e.extend({regexpTest:function(e,t){try{return new RegExp(e).test(t)}catch(r){throw new Error("在mxmvc.main.js中：regexpTest函数出现异常，异常信息为："+r.message)}}})})(jQuery);