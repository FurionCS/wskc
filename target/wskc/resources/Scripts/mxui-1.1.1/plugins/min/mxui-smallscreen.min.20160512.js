var smallscreen_reset=function(){$.smallscreen.reset()};(function(e){e.smallscreen={dh:null,toolbar:null,searchbar:null,tree:null,mintree:null};e.smallscreen.init=function(){if(!isPage_UseApp){return}e.smallscreen.dh=e("#dh-bar");e.smallscreen.toolbar=e("#tb");e.smallscreen.searchbar=e("#searchBar");e.smallscreen.tree=e("#tree_large");e.smallscreen.mintree=e("#tree_min");e(window).off("resize.smallscreen").on("resize.smallscreen",function(a){e.smallscreen.reset()});e.smallscreen.reset()};e.smallscreen.reset=function(){if(!isPage_UseApp){return}var a=e.smallscreen.dh;if(e.browser.useapp){e("body").addClass("mx-xs");if(a.length>0){a.removeClass("hidden")}}else{e("body").removeClass("mx-xs");if(a.length>0){a.addClass("hidden")}}e.smallscreen.set_tree();e.smallscreen.set_toolbar();e.smallscreen.set_searchbar();e.smallscreen.set_add();exresize()};e.smallscreen.set_toolbar=function(){var a=e.smallscreen.dh;if(e.browser.useapp){if(a.length>0){a.removeClass("hidden");if(!e.smallscreen.btnEH_toolbar){e.smallscreen.btnEH_toolbar=e('<div class="btn-group pull-right"><button type="button" class="btn  no-border dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="ace-icon fa fa-reorder "></i></button><ul class="dropdown-menu dropdown-light"></ul></div>').appendTo(a);e.smallscreen.set_toolbar_c()}}if(e.smallscreen.toolbar&&e.smallscreen.toolbar.length>0){e.smallscreen.toolbar.addClass("hidden")}}else{if(e.smallscreen.toolbar&&e.smallscreen.toolbar.length>0){e.smallscreen.toolbar.removeClass("hidden")}}};e.smallscreen.set_toolbar_c=function(){if(!e.smallscreen.btnEH_toolbar){return}var a=e.smallscreen.btnEH_toolbar.find("ul.dropdown-menu");if(e.smallscreen.toolbar&&e.smallscreen.toolbar.length>0){e.smallscreen.toolbar.find(">.btn-toolbar,div.mx-toolbar>.btn-toolbar").each(function(t,i){var n=e(i);if(n.attr("id")=="btnSearch"){return true}if(n.hasClass("btn-group")){var l=n.find(">button").html();var r=e('<li class="dropup dropdown-hover mxtb-dropdown"><a href="###"  tabindex="-1">'+l+'<i class="ace-icon fa fa-caret-left pull-right" style="margin-top: 3px;"></i></a></li>').appendTo(a);e('<li class="divider"></li>').appendTo(a);r.find("i.icon-on-right").remove();var s=e('<ul class="dropdown-menu dropdown-menu-right"></ul>').appendTo(r);var d=n.find(">ul");d.find(">li").each(function(a,t){$liO=e(t);var i=e("<li>"+$liO.html()+"</li>").appendTo(s);i.attr("settag",$liO.attr("settag"));i.attr("authtag",$liO.attr("authtag"));if($liO.hasClass("disabled")||$liO.hasClass("hidden")){i.addClass("hidden")}e.data(i[0],"linkbtn",$liO);e.data($liO[0],"linkbtn",i);i.on("click",function(a){var t=e.data(this,"linkbtn");t.trigger("click")})})}else{var l=n.html();var r=e('<li><a href="#"  tabindex="-1">'+l+"</a></li>").appendTo(a);r.attr("settag",n.attr("settag"));r.attr("authtag",n.attr("authtag"));if(n.hasClass("disabled")||n.hasClass("hidden")){r.addClass("hidden")}e.data(r[0],"linkbtn",n);e.data(n[0],"linkbtn",r);r.on("click",function(a){var t=e.data(this,"linkbtn");t.trigger("click")})}});e('<li class="divider"></li>').appendTo(a)}e('<li ><a href="#"  tabindex="-1" onclick="window.parent.RefThisTab()"><i class="ace-icon fa fa-refresh green"></i>刷新页面</a></li>').appendTo(a);e('<li ><a href="#"  tabindex="-1" onclick="window.parent.returnFirstPage()"><i class="ace-icon fa fa-reply orange"></i>返回首页</a></li>').appendTo(a)};e.smallscreen.set_searchbar=function(){var a=e("#btnSearch");if(a.length<=0){return}var t=e.smallscreen.dh;if(e.browser.useapp){if(t.length>0){t.removeClass("hidden");if(!e.smallscreen.btnEH_searchbar){e.smallscreen.btnEH_searchbar=e('<button type="button" class="btn  no-border  pull-left" ><i class="ace-icon fa fa-filter"></i></button>').appendTo(t);e.smallscreen.btnEH_searchbar.on("click",function(a){e("#btnSearch").trigger("click")})}}e.smallscreen.searchbar.addClass("hidden")}else{if(t.length>0){t.addClass("hidden")}if(bShowSearchBar){e.smallscreen.searchbar.removeClass("hidden")}}};e.smallscreen.set_searchbar_av=function(){if(e.smallscreen.btnEH_searchbar){e.smallscreen.btnEH_searchbar.remove()}if(e.smallscreen.dh.length<=0){return}e.smallscreen.btnEH_searchbar=e('<div class="btn-group pull-left"><button type="button" class="btn  no-border dropdown-toggle pull-right" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="ace-icon fa fa-search"></i></button><ul class="dropdown-menu dropdown-light"><li class="divider"></li><li  class="avsearch"><a href="#"  tabindex="-1" ><i class="ace-icon fa fa-search-plus green"></i>高级查询</a></li></ul></div>').appendTo(e.smallscreen.dh);if(e.smallscreen.searchbar&&e.smallscreen.searchbar.length>=0){var a=e.smallscreen.searchbar.find(".sPlan").find("select");var t=e.smallscreen.btnEH_searchbar.find("ul");var i="";a.find("option").each(function(a,t){var n=e(t);i+='<li  class="splan" data-value="'+n.attr("value")+'"><a href="#"  tabindex="-1" >'+n.text()+"</a></li>"});var n=e(i).prependTo(t);t.find("li.splan").on("click",function(a){var t=e(this);var i=t.data("value");var n=e.smallscreen.searchbar.find(".sPlan").find("select");n.val(i);n.trigger("change")})}e.smallscreen.btnEH_searchbar.find("li.avsearch").on("click",function(a){e("#btnSearch").trigger("click")})};e.smallscreen.set_add=function(){var a=e("#btnAdd");if(a.length<=0){return}var t=e.smallscreen.dh;if(e.browser.useapp){if(t.length>0){t.removeClass("hidden");if(!e.smallscreen.btnEH_add){e.smallscreen.btnEH_add=e('<button type="button" class="btn  no-border  pull-right" ><i class="ace-icon fa fa-plus"></i></button>').appendTo(t);e.smallscreen.btnEH_add.on("click",function(a){e("#btnAdd").trigger("click")})}}e.smallscreen.searchbar.addClass("hidden")}else{if(t.length>0){t.addClass("hidden")}if(bShowSearchBar){e.smallscreen.searchbar.removeClass("hidden")}}};e.smallscreen.set_tree_p=function(a,t){if(!(a&&a.length>0)){return}if(e.browser.useapp){if(t.length>0){t.removeClass("hidden");if(t.find("button.btntree").length<=0){var i=e('<button type="button" class="btn  no-border  pull-left btntree" ><i class="ace-icon fa fa-sitemap"></i></button>').appendTo(t);i.on("click",function(t){if(a.hasClass("open")){e.smallscreen.hidetree(a)}else{e.smallscreen.showtree(a)}})}}a.removeClass("open");a.addClass("hidden")}else{if(t.length>0){t.addClass("hidden")}a.removeClass("open");a.removeClass("hidden")}};e.smallscreen.set_tree=function(){e.smallscreen.set_tree_p(e.smallscreen.tree,e.smallscreen.dh)};e.smallscreen.hidetree=function(e){if(!e){return}if(e.hasClass("open")){var a=e.height();e.animate({top:-a},500,function(){e.removeClass("open");e.addClass("hidden")})}};e.smallscreen.showtree=function(e){if(!e){return}if(e.hasClass("open")){return}e.removeClass("hidden");var a=e.height();e.addClass("open");e.css({top:-(a-40)});e.animate({top:40},500)}})(jQuery);var appview=$.extend({},$.fn.datagrid.defaults.view,{render:function(e,a,t){if(t){return}var i=$.data(e,"datagrid");var n=i.options;var l=i.panel;if(l&&l.length>0){l.addClass("div-table")}if(n.bodyView){l.addClass("bodyView")}$(a).off("click.apptable.hide").on("click.apptable.hide","div.div-table-row-body>button.hidedetail",function(){var a=$(this);var t=a.closest("tr");if(t&&t.length>0){var i=t.attr("datagrid-row-index");if(t.hasClass("datagrid-row-selected")){$(e).datagrid("unselectRow",i);return false}}});$(a).off("click.apptable.show").on("click.apptable.show","div.div-table-row-head button.showdetail",function(){var a=$(this);var t=a.closest("tr");if(t&&t.length>0){var i=t.attr("datagrid-row-index");$(e).datagrid("selectRow",i);if(!n.rptView){if(n.onShowDetail){n.onShowDetail.call(e,i)}else{showTableRow(e)}}}});$(a).off("touchstart.apptable.touch touchmove.apptable.touch touchend.apptable.touch").on("touchstart.apptable.touch touchmove.apptable.touch touchend.apptable.touch","div.div-table-row-head>div.div-table-row-head-content",function(e){var a=$(this);var t=a.closest("tr");var i=e.originalEvent.changedTouches[0];var n=a.attr("touchType");var l=a.attr("touchX")*1;var r=a.attr("touchY")*1;var s=t.find("div.div-table-row-head-buttons");if(s.length<=0){return}var d=s.outerWidth();switch(e.type){case"touchstart":a.attr("touchX",i.clientX);a.attr("touchY",i.clientY);a.attr("touchType","NO");t.closest("table.datagrid-btable").find("tr.datagrid-row").each(function(e,a){$(a).find("div.div-table-row-head-content").css({left:0})});break;case"touchmove":if(n=="NO"){var o=i.clientX-l;var c=i.clientY-r;if(Math.abs(o)<Math.abs(c)){a.attr("touchType","V");return}else{a.attr("touchType","H")}}else if(n=="V"){return}if(!a.hasClass("monving")){a.addClass("moving")}var f=i.clientX;var o=f-l;if(o<0&&o*-1<=d){a.css({left:o+"px"});e.preventDefault()}break;case"touchend":a.attr("touchType","NO");if(n!="H"){return}if(a.hasClass("moving")){a.removeClass("moving")}var f=i.clientX;var o=f-l;if(o*-1<50){a.css({left:0})}else{a.css({left:d*-1})}break;default:break}});$(a).off("click.apptable.movebtn").on("click.apptable.movebtn","div.div-table-row-head>div.div-table-row-head-buttons>button",function(a){var t=$(this);var i=t.closest("tr");if(i&&i.length>0){var n=i.attr("datagrid-row-index");$(e).datagrid("selectRow",n);var l=$.data(e,"datagrid");var r=l.options;var s=t.data("tag");r.onMoveButtonClick.call(e,s,n)}});var r=i.data.rows;var s=$(e).datagrid("getColumnFields",t);s=$.grep(s,function(a,t){var i=$(e).datagrid("getColumnOption",a);if(i&&(i.hidden==undefined||i.hidden==false)){return true}else{return false}});if(!s||s.length<=0){return}if(!n.appconfig){n.appconfig={}}if(n.appconfig.infofields&&n.appconfig.infofields.length>0){}else{if(s.length>3){n.appconfig.infofields=$.grep(s,function(e,a){return a<3})}else{n.appconfig.infofields=s}}if(!n.appconfig.headfields){n.appconfig.headfields=[];$.each(n.appconfig.infofields,function(e,a){n.appconfig.headfields.push(a)})}if(!n.appconfig.stateField){n.appconfig.stateField="rowState"}if(!n.appconfig.titleField){n.appconfig.titleField=n.appconfig.infofields[0];n.appconfig.infofields.splice(0,1)}n.appconfig.uFields=[];if(n.appconfig.imageField){n.appconfig.uFields.push(n.appconfig.imageField)}if(n.appconfig.stateField){n.appconfig.uFields.push(n.appconfig.stateField)}if(n.appconfig.titleField){n.appconfig.uFields.push(n.appconfig.titleField)}$.each(n.appconfig.infofields,function(e,a){n.appconfig.uFields.push(a)});if(n.appconfig.moneyField){if($.isArray(n.appconfig.moneyField)){$.each(n.appconfig.moneyField,function(e,a){n.appconfig.uFields.push(a)})}else{n.appconfig.uFields.push(n.appconfig.moneyField)}}s=$.grep(s,function(e,a){return $.inArray(e,n.appconfig.uFields)==-1});n.appconfig.oFields=s;l.find("div.datagrid-header").removeClass("hidden");if(!n.bodyView){l.find("div.datagrid-header table.datagrid-htable tr.datagrid-header-row>td").each(function(e,a){var t=$(a).attr("field");if($.inArray(t,n.appconfig.headfields)==-1){$(a).remove()}});l.find("div.datagrid-header table.datagrid-htable tr.datagrid-header-row").each(function(e,a){if($(a).find(">td").length<=0){$(a).remove()}})}else{l.find("div.datagrid-header").remove();if(l.find("div.datagrid-view2>div.datagrid-header2").length<=0){l.find("div.datagrid-view2").prepend('<div class="datagrid-header2 widget-header datagrid-header"><h5 class="widget-title bigger">	<i class="ace-icon fa fa-table"></i> '+n.bodyTitle+' </h5>   <div class="widget-toolbar "><button name="add" type="button" class="btn btn-toolbar btn-white  no-border btn-success edit"><i class="ace-icon fa fa-plus"></i></button><button name="edit" type="button" class="btn btn-toolbar btn-white btn-info no-border edit"><i class="ace-icon fa fa-edit"></i></button><button name="delete" type="button" class="btn btn-toolbar btn-white btn-danger no-border edit"><i class="ace-icon fa fa-minus"></i></button><button name="view" type="button" class="btn btn-toolbar btn-white btn-info2 no-border view"><i class="ace-icon fa fa-credit-card"></i></button></div> </div>');var d=l.find("div.datagrid-view2>div.datagrid-header2>div.widget-toolbar");d.find('button[name="add"]').on("click",function(a){var t=$.data(e,"datagrid");var i=t.options;if(i.onAddClick!=null){var n=i.onAddClick.call(e);if(n==false){return}}var l=$(e).datagrid("getSelected");var r=0;if(l){r=$(e).datagrid("getRowIndex",l)+1}else{r=$(e).datagrid("getRows").length}$(e).datagrid("insertRow",{index:r,row:i.getNewBodyRow.call(e)});$(e).datagrid("selectRow",r);showTableRow(e)});d.find('button[name="edit"]').on("click",function(a){var t=$.data(e,"datagrid");var i=t.options;if(i.onEditClick!=null){i.onEditClick.call(e);return}showTableRow(e)});d.find('button[name="delete"]').on("click",function(a){var t=$.data(e,"datagrid");var i=t.options;if(i.onDelClick!=null){i.onDelClick.call(e);return}var n=$(e).datagrid("getSelected");var l=0;if(!n){$.messager.alert("","请选中您要删除的行！");return}l=$(e).datagrid("getRowIndex",n);var r=t;i.beforeDelRow.call(e,l);$(e).datagrid("deleteRow",l);i.afterDelRow.call(e)});if(!n.showAdd){d.find('button[name="add"]').addClass("hidden")}if(!n.showEdit){d.find('button[name="edit"]').addClass("hidden")}if(!n.showDel){d.find('button[name="delete"]').addClass("hidden")}d.find('button[name="view"]').on("click",function(a){showTableRow(e)})}}var o=[];o.push('<table class="div-btable datagrid-btable width-100"><tbody>');for(var c=0;c<r.length;c++){var f=c%2&&n.striped?'class="datagrid-row-alt"':"";o.push('<tr class="datagrid-row" datagrid-row-index="'+c+'" >');o.push(this.renderRow.call(this,e,[],false,c,r[c]));o.push("</tr>")}o.push("</tbody></table>");$(a).html(o.join(""))},renderRow:function(e,a,t,i,n){if(t){return}var l=$.data(e,"datagrid");var r=l.options;var s=r.appconfig;uFields=s.uFields;oFields=s.oFields;if(!uFields){uFields=[]}if(!oFields){oFields=[]}var d=[];d.push('<td><div  class="div-table-row ">');if(!s.imageField){d.push('<div class="div-table-row-head"><div class="div-table-row-head-content">')}else{d.push('<div  class="div-table-row-head div-table-row-image"><div class="div-table-row-head-content">')}if(!r.bodyView&&!r.rptView){d.push('<button class="btn btn-toolbar btn-white btn-info2 no-border showdetail" type="button"><i class="ace-icon fa fa-angle-double-right bigger-150"></i></button>')}$.each(uFields,function(a,t){var l=n[t];if(l==null||l==undefined){l=""}var r=$(e).datagrid("getColumnOption",t);if(!r){return true}if(r.hidden){return true}var o=r.apptitle;if(!o){o=r.title}if(r.formatter){l=r.formatter(l,n,i)}o+=":";if(t==s.imageField){d.push('<div field="'+t+'" class="pull-left info-image">'+l+"</div>");return true}if(t==s.stateField){d.push('<div field="'+t+'" class="info-state">'+l+"</div>");return true}if(t==s.titleField){d.push('<div field="'+t+'" class="info-title">'+l+"</div>");return true}if(s.moneyField){if($.isArray(s.moneyField)){if($.inArray(t,s.moneyField)!=-1){d.push('<div field="'+t+'" class="info info-money"><span class="title">'+o+'</span><span class="value">'+l+"</span></div>");return true}}else{if(t==s.moneyField){d.push('<div field="'+t+'" class="info info-money"><span class="title">'+o+'</span><span class="value">'+l+"</span></div>");return true}}}d.push('<div field="'+t+'"  class="info"><span class="title">'+o+'</span><span class="value">'+l+"</span></div>")});d.push("</div>");var o=r.getMoveShowButtons.call(e,i,n);if(o.length>0){d.push('<div class="div-table-row-head-buttons">');$.each(o,function(e,a){var t=$(a);d.push(a)});d.push("</div>")}d.push("</div>");if(r.rptView){if(oFields.length>0){d.push('<div class="div-table-row-body">');d.push('<button class="btn btn-toolbar btn-white btn-warning no-border hidedetail" style="float:right;"  type="button"><i class="ace-icon fa fa-angle-double-up bigger-150"></i></button>');$.each(oFields,function(a,t){var l=n[t];if(l==null||l==undefined){l=""}var r=$(e).datagrid("getColumnOption",t);if(r.hidden){return true}if(r.formatter){l=r.formatter(l,n,i)}var s=r.apptitle;if(!s){s=r.title}s+=":";d.push('<div field="'+t+'"  class="info"><span class="title">'+s+'</span><span class="value">'+l+"</span></div>")});d.push("</div>")}}else{}d.push("</div></td>");var c=l.panel;var f=c.find("div.datagrid-view2>div.datagrid-body>table");if(f&&!f.hasClass("div-btable")){f.addClass("div-btable datagrid-btable width-100")}return d.join("")},renderFooter:function(e,a,t){if(t){return}var i=$.data(e,"datagrid");var n=i.options;if(!n.appconfig||!n.appconfig.totalfields||n.appconfig.totalfields.length<=0){return}var l=i.data.footer;if(!l){l=i.footer}if(!l||l.length<=0){return}var r=[];r.push('<div class="div-ftable datagrid-ftable width-100">');for(var s=0;s<l.length;s++){var d=l[s];r.push('<div class="div-ftable-row" datagrid-row-index="'+s+'" >');$.each(n.appconfig.totalfields,function(a,t){var i=d[t];if(i==null||i==undefined){i=""}var n=$(e).datagrid("getColumnOption",t);if(!n){return true}if(n.hidden){return true}if(n.formatter){i=n.formatter(i,d,s)}var l=n.apptitle;if(!l){l=n.title}l+=":";r.push('<div field="'+t+'" class="info-footer">');r.push('<span class="title">'+l+"</span>");r.push('<span class="value">'+i+"</span>");r.push("</div>")});r.push("</div>")}r.push("</div>");$(a).html(r.join(""))}});var showTableRow=function(e){var a=$.data(e,"datagrid");if(!a){return}var t=$(e).datagrid("getSelected");if(!t){$.messager.alert("","请选中您要查看或编辑的行！");return}var i=a.options;var n=$(e).datagrid("getRowIndex",t);if(!t){return}var l=$(e).datagrid("getColumnFields",false);l=$.grep(l,function(a,t){var i=$(e).datagrid("getColumnOption",a);if(i&&(i.hidden==undefined||i.hidden==false)){return true}else{return false}});if(!l||l.length<=0){return}var r=[];$.each(l,function(a,t){var n=$(e).datagrid("getColumnOption",t);var l=n.apptitle;if(!l){l=n.title}if(i.canedit){var s=$.inArray(t,i.fieldArray);if(s!=-1){r.push('<div class="form-group editor body-cell-c" field="'+t+'"> <label  class="blue">'+l+'</label> <div class="editorC body-cell"> </div> </div>')}else{r.push('<div class="form-group  body-cell-c" field="'+t+'"> <label  class="">'+l+'</label> <div class="body-cell"> </div> </div>')}}else{r.push('<div class="form-group  body-cell-c" field="'+t+'"> <label >'+l+'</label> <div class="body-cell"  ></div> </div>')}});var s=i.div_rowdetail;if(!s){s=$('<div class="row mx-dialog-c  mx-row-detail" rowIndex="'+n+'">').appendTo("body");$(r.join("")).appendTo(s)}else{s.attr("rowIndex",n);s.empty();$(r.join("")).appendTo(s)}var d='<h5 style="margin-top:5px;margin-bottom:5px;"><i class="ace-icon fa fa-credit-card fa-2x green" style="margin-right:5px;"></i>行数据查看</h5>';if(i.canedit){d='<h5 style="margin-top:5px;margin-bottom:5px;"><i class="ace-icon fa fa-credit-card fa-2x green" style="margin-right:5px;"></i>行数据编辑</h5>'}var o=[];if(i.canedit){o.push({dom:'<button class="btn btn-sm btn-success  no-border mx-xs-quick"><i class="ace-icon fa fa-check"></i><span class="">确定</span></button>',handler:function(){$(e).datagrid("ex_endEdit",i.crowindex);s.bs_dialog("close")}})}else{}s.bs_dialog({width:"",title:d,buttons:o,onClose:function(){},onShow:function(){var a=$(this).attr("rowIndex");var t=$.data(e,"datagrid");var n=t.data.rows;$(e).datagrid("ex_setBodyRowValue",{row:n[a],rowIndex:a});if(i.onDetailShow!=null){i.onDetailShow.call(e,a,n[a])}}});s.closest("div.modal-dialog").addClass("No_NeedEndEditDG");s.drawformcard(1);i.div_rowdetail=s;if(i.canedit){s.find("div.body-cell").bind("click",function(a){var t=$(this);if(t.hasClass("editing")){return false}var n=t.closest("div.body-cell-c");var l=n.attr("field");var r=t.closest("div.mx-row-detail");var s=r.attr("rowIndex");i.onClickCell.call(e,s,l,t.find(">input").val());return false})}s.bs_dialog("open")};