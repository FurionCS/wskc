(function(e){e.fn.reftext=function(a,i){if(typeof a=="string"){var n=e.fn.reftext.methods[a];if(n){return n(this,i)}}a=a||{};return this.each(function(){var i=e.data(this,"reftext");a=e.extend({},a.initui?a.initui(a.inittag):{},a);if(i){e.extend(i.options,a)}else{i=e.data(this,"reftext",{options:e.extend({},e.fn.reftext.defaults,a),reftext:null});i.reftext=t(this)}r(this)})};e.fn.reftext.defaults={title:"数据选择参照",serchWarterMark:"请输入关键字进行过滤...",width:120,height:null,refwidth:400,refheight:400,gridurl:"",gridparams:{},treeurl:"",disabled:false,isclick:false,treeparams:{},treeandgridTitle:"树选择",treeandgridIcon:"fa-th-list",valuepath:"",textpath:"",readonly:false,bsmnode:false,value:null,text:null,showtype:"grid",inittag:"",usemy:false,item:null,OnRefClick:function(e){},OnSelectItem:function(e){},onEnterSearch:function(e,t){},isEnterTab:true,OnSelectItems:function(e){},isCanCustom:false,isSearchWhenBlur:true,isTAGSelectFirst:true,OnBeginLoad:function(e){return e},isInDG:false,qa_config:null,pagesize:20};e.fn.reftext.methods={SetItems:function(t,a){var i=e.data(t[0],"reftext").options;i.OnSelectItems.call(t[0],a)},SetItem:function(e,t){d(e[0],t)},SetValue:function(e,t){f(e[0],t)},SetText:function(e,t){c(e[0],t)},GetText:function(t){var a=e.data(t[0],"reftext");return a.options.text},GetValue:function(t){return e.data(t[0],"reftext").options.value},GetItem:function(t){return e.data(t[0],"reftext").options.item},focus:function(t){e.data(t[0],"reftext").reftext.find("input.reftext-text").focus()},options:function(t){return e.data(t[0],"reftext").options},resize:function(t,a){var i=e.data(t[0],"reftext").options;i.width=a.width;i.height=a.height;g(t[0],false);u(t[0])},destroy:function(t){t.each(function(t,a){var i=e.data(this,"reftext");i.reftext.remove();e(this).remove()})},disable:function(e){e.each(function(){a(this,true)})},enable:function(e){e.each(function(){a(this,false)})},textbox:function(e){return v(e[0])},clearRefDialog:function(e){h(e[0])},showRefDialog:function(e){p(e[0])}};var t=function(t){e(t).hide();var a=e.data(t,"reftext").options;var i=e('<span class="input-icon input-icon-right reftext mx-input-group"></span>').insertAfter(t);i.addClass(e(t).attr("class"));i.removeClass("form-control");if(e.browser.useapp&&!a.isCanCustom){a.readonly=true}var r=a.readonly?" readonly":" ";var n=e('<input type="text" class="form-control reftext-text"'+r+">").appendTo(i);e('<i class="ace-icon fa fa-search  bigger-120 reftext-search-button"></i>').appendTo(i);var o=e('<input type="hidden" class="reftext-value"/>').appendTo(i);e(t).addClass("reftext-f");var s=e(t).attr("name");if(s){e(t).removeAttr("name");e(t).attr("reftextName",s);o.attr("name",s)}return i};function a(t,a){var i=e.data(t,"reftext").options;var r=e.data(t,"reftext").reftext;if(a){i.disabled=true;e(t).attr("disabled",true);r.find(".reftext-text").attr("disabled",true);r.find(".reftext-value").attr("disabled",true)}else{i.disabled=false;e(t).removeAttr("disabled");r.find(".reftext-text").removeAttr("disabled");r.find(".reftext-value").removeAttr("disabled")}}var i=false;function r(t){var a=e.data(t,"reftext");var r=a.options;var n=a.reftext.find("input.reftext-text");var s=a.reftext.find(".reftext-search-button");n.unbind(".reftext").bind("blur.reftext",function(a){var n=e.data(t,"reftext");if(!n.options.isSearchWhenBlur){if(n.options.isCanCustom){if(n.isInDG){i=true;o(t,true)}else{o(t,false)}}else{var s=n.reftext.find("input.reftext-text");s.val(r.text)}return}if(!i){o(t,false)}else{i=false}}).bind("keydown.reftext",function(e){var a=window.event?true:false;var n;var s;if(a){n=window.event.keyCode;if(n==13||n==9){i=true;o(t,true);if(!r.isEnterTab){return e.returnValue=false}else{window.event.keyCode=9}}}else{n=e.which;if(n==13||n==9){i=true;o(t,true);if(!r.isEnterTab){e.which=null}else{e.which=9}}}});var l=s;if(e.browser.useapp&&!r.isCanCustom){l=a.reftext}l.unbind(".reftext").bind("click.reftext",function(){if(r.disabled){return}if(r.isclick){return}if(a.isForSearching){a.isForSearching=false;return}e("body").showLoading("a");r.isclick=true;if(!r.usemy){h(t);r.OnBeginLoad.call(t,r);switch(r.showtype){case"grid":e(t).showgridref(function(e){d(t,e)});break;case"treegrid":e(t).showtreegridref(function(e){d(t,e)});break;case"treeandgrid":e(t).showtreeandgridref(function(e){d(t,e)});break;default:break}}else{r.OnBeginLoad.call(t,r);r.OnRefClick.call(t,r.item)}window.setTimeout(function(){e("body").hideLoading();r.isclick=false},1e3)}).bind("mouseenter.reftext",function(){if(r.disabled){return}e(this).addClass("red")}).bind("mouseleave.reftext",function(){if(r.disabled){return}e(this).removeClass("red")})}var n=false;function o(t,a){if(n){return}var i=e.data(t,"reftext");var r=i.options;if(r.readonly){r.onEnterSearch.call(t,false,a);return}var o=i.reftext.find("input.reftext-text");var f=o.val();if(r.isCanCustom){d(t,f);r.onEnterSearch.call(t,true,a);return}if(f==r.text){r.onEnterSearch.call(t,false,a);return}if(e.trim(f)==""){d(t,null);r.onEnterSearch.call(t,false,a);return}s(o);r.OnBeginLoad.call(t,r);i["isForSearching"]=true;r.gridparams["pageNumber"]=1;r.gridparams["pageSize"]=51;e.ajax({type:"POST",url:r.gridurl,data:e.extend({},r.gridparams,{search:e.trim(f)}),success:function(n){l(o);if(typeof n=="string"){e.messager.alert("",n);d(t,null);r.onEnterSearch.call(t,false,a);return}else{if(!n.rows||n.rows.length<=0){d(t,null);r.onEnterSearch.call(t,false,a);return}if(n.rows.length==1){d(t,n.rows[0]);r.onEnterSearch.call(t,true,a);return}if(n.rows.length>1&&n.rows.length<=50){e(t).showgridrefbysearch(n,function(e){d(t,e);r.onEnterSearch.call(t,true,a)});return}if(n.rows.length>50){i.isForSearching=false;var s=i.reftext.find(".reftext-search-button");s.trigger("click")}}},error:function(e,t,a){l(o)}})}function s(e){n=true;e.addClass("reftext-loading");e.val("正在加载数据...")}function l(e){n=false;e.removeClass("reftext-loading");e.val("")}function d(t,a){var i=e.data(t,"reftext");if(!i){return}var r=i.options;r.item=a;var n=i.reftext.find("input.reftext-text");if(a==null){n.val("");r.value=null;i.reftext.find(":hidden.reftext-value").val("");r.text=""}else if(e.type(a)=="string"){r.value=a;r.text=a;n.val(r.text);i.reftext.find(":hidden.reftext-value").val(a)}else{r.value=a[r.valuepath];r.text=a[r.textpath];n.val(r.text);i.reftext.find(":hidden.reftext-value").val(a[r.valuepath])}r.OnSelectItem.call(t,a)}function f(t,a){var i=e.data(t,"reftext");var r=i.options;if(a==null){d(t,null);return}r.value=a;i.reftext.find(":hidden.reftext-value").val(a);if(r.text==""){r.item=null}else{if(r.item==null){r.item={}}r.item[r.valuepath]=a}}function c(t,a){var i=e.data(t,"reftext");var r=i.options;var n=i.reftext.find("input.reftext-text");if(a==null){d(t,null);return}r.text=a;n.val(r.text);if(a==""){r.item=null}else{if(r.item==null){r.item={}}r.item[r.textpath]=a}}function u(e){}function g(t,a){var i=e.data(t,"reftext");var r=i.options;var n=i.reftext;i.reftext.outerWidth(r.width)}var v=function(t){var a=e.data(t,"reftext");return a.reftext.find("input.reftext-text")};var h=function(t){var a=e.data(t,"reftext");if(!a){return}if(!a.divref){return}a.divref.bs_dialog("destory");a.divref=null};var p=function(t){var a=e.data(t,"reftext");var i=a.options;var r=a.reftext.find(".reftext-search-button");r.trigger("click")};e.fn.showgridref=function(t){var a=e.data(this[0],"reftext");if(!a){return}var i=a.options;url=i.gridurl;params=i.gridparams;width=i.refwidth;height=i.refheight;title=i.title;var r=i.pagesize;var n=1;var o=e('<div class="row"></div>').appendTo("body");a.divref=o;var s=e('<div class="col-sm-12 form-horizontal"></div>').appendTo(o);var l=e('<div class=""><div class="input-group input-icon"><input class="form-control" type="text" placeholder="'+i.serchWarterMark+'" style="border:1px solid #6fb3e0;">	<span class="input-group-btn">	<button  class="btn  btn-info btn-no-border" type="button" style="height: 34px;">过滤</button></span> <i class="ace-icon fa fa-filter" style="color:#6fb3e0;"></i></div></div></div>').appendTo(s);e('<div class="col-sm-12" style="height:10px;"></div>').appendTo(o);var d=l.find("input");var f=l.find("button");var c=e('<div class="col-sm-12" style="height:300px;"><div class="mx-datarid-c"></div></div>').appendTo(o).find(">div");d.keydown(function(e){if(event.keyCode==13){f.trigger("click")}});f.click(function(){var t=d.val();n=1;params["search"]=t;var a=u.exdatagrid("getPager");e(a).pagination({pageNumber:1});p()});var u=e("<table  ></table>").appendTo(c);var g=function(){var a=u.exdatagrid("getSelected");if(a){o.bs_dialog("close");t.call(this,a)}else{e.messager.alert("","请选择一行数据!")}};var v=[{dom:'<button class="btn btn-sm btn-success btn-next mx-xs-quick" ><i class="ace-icon fa fa-check "></i><span class="">选入</span></button>',handler:function(){g()}}];if(i.qa_config){v.push({dom:'<button class="btn btn-sm btn-info2 btn-next" style="float:left"><i class="ace-icon fa fa-plus bigger-110"></i><span class="bigger-110">'+i.qa_config.title+"</span></button>",handler:function(){if(a.divref){a.divref.bs_dialog("close");a.divref.bs_dialog("destory")}i.qa_config.quickClick.call(i.qa_config)}})}o.bs_dialog({width:"",title:'<h5 style="margin-top:5px;margin-bottom:5px;"><i class="ace-icon fa fa-search orange bigger-120" style="margin-right:5px;"></i>'+title+"</h5>",buttons:v,onClose:function(){o.bs_dialog("destory")},onShow:function(){o.bs_dialog("showLoading","");var e=o.closest("div.modal-body").height()-s.height()-10;c.height(e);u.exdatagrid({iconCls:"icon-table",fit:true,singleSelect:true,loadMsg:"正在加载数据,请稍后...",rownumbers:true,border:true,noheader:true,pagination:true,onLoadSuccess:function(e){},onDblClickRow:function(){g()}});p()}});o.bs_dialog("open");var h=false;var p=function(){params["pageNumber"]=n;params["pageSize"]=r;u.exdatagrid("loading");e.ajax({type:"POST",url:url,data:params,success:function(t){o.bs_dialog("hideLoading");if(typeof t=="string"){e.messager.alert("",t)}else{if(!h){ReCorventColumnFormatter(t.columns);ReCorventColumnFormatter(t.frozenColumns);u.exdatagrid({columns:t.columns,frozenColumns:t.frozenColumns});h=true;b()}u.exdatagrid("loadData",t);u.exdatagrid("loaded")}}})};var b=function(){var t=u.exdatagrid("getPager");if(t){e(t).pagination({showPageList:true,pageNumber:1,pageSize:r,showRefresh:false,showPageList:false,onSelectPage:function(e,t){n=e;p()}})}}};e.fn.showgridrefbysearch=function(t,a){var i=e.data(this[0],"reftext");if(!i){return}var r=i.options;var n=r.refwidth;var o=r.refheight;var s=r.title;var l=e('<div class="row"></div>').appendTo("body");i.divref=l;var d=e('<div class=""></div>').appendTo(l);var f=e('<div class="col-sm-12" style="height:250px;"><div class="mx-datarid-c"></div></div>').appendTo(d).find(">div");var c=e("<table  ></table>").appendTo(f);var u=function(){var t=c.exdatagrid("getSelected");if(t){l.bs_dialog("close");a.call(this,t)}else{e.messager.alert("","请选择一行数据!")}};l.bs_dialog({width:"",title:'<h5 style="margin-top:5px;margin-bottom:5px;"><i class="ace-icon fa fa-flash orange bigger-120" style="margin-right:5px;"></i>'+s+" - 快速选择窗</h5>",buttons:[{dom:'<button class="btn btn-sm btn-success btn-next mx-xs-quick" ><i class="ace-icon fa fa-check"></i><span class="">选入</span></button>',handler:function(){u()}}],onClose:function(){l.bs_dialog("destory")},onShow:function(){l.bs_dialog("showLoading","");var e=l.closest("div.modal-body").height()-10;f.height(e);c.exdatagrid({iconCls:"icon-table",fit:true,singleSelect:true,loadMsg:"正在加载数据,请稍后...",rownumbers:true,border:true,noheader:true,pagination:false,onLoadSuccess:function(e){l.bs_dialog("hideLoading")},onDblClickRow:function(){u()}});c.exdatagrid("loading");ReCorventColumnFormatter(t.columns);ReCorventColumnFormatter(t.frozenColumns);c.exdatagrid({columns:t.columns,frozenColumns:t.frozenColumns});c.exdatagrid("loadData",t);c.exdatagrid("loaded")}});l.bs_dialog("open")};e.fn.showtreegridref=function(t){var a=e.data(this[0],"reftext");if(!a){return}var i=a.options;var r=i.gridurl;var n=i.gridparams;var o=i.bsmnode;var s=i.refwidth;var l=i.refheight;var d=i.title;var f=e('<div class="row"><div class="col-sm-12" style="height:250px;"><div class="mx-datarid-c"></div></div></div>').appendTo("body");a.divref=f;var c=e('<table style="top: 0px; right: 0px; left: 0px; position: absolute;bottom: 0px;"></table>').appendTo(f.find(">div>div"));var u=function(){var a=c.treegrid("getSelected");if(a){if(o){f.bs_dialog("close");t.call(this,a)}else{if(a.children){c.treegrid("toggle",a.id)}else{f.bs_dialog("close");t.call(this,a)}}}else{e.messager.alert("","请选择一行数据!")}};var g=[{dom:'<button class="btn btn-sm btn-success btn-next mx-xs-quick" ><i class="ace-icon fa fa-check"></i><span class="">选入</span></button>',handler:function(){u()}}];if(i.qa_config){g.push({dom:'<button class="btn btn-sm btn-info2 btn-next" style="float:left"><i class="ace-icon fa fa-plus bigger-110"></i><span class="bigger-110">'+i.qa_config.title+"</span></button>",handler:function(){if(a.divref){a.divref.bs_dialog("close");a.divref.bs_dialog("destory")}i.qa_config.quickClick.call(i.qa_config)}})}f.bs_dialog({width:"",title:'<h5 style="margin-top:5px;margin-bottom:5px;"><i class="ace-icon fa fa-search orange bigger-120" style="margin-right:5px;"></i>'+d+"</h5>",buttons:g,onClose:function(){f.bs_dialog("destory")},onShow:function(){f.bs_dialog("showLoading","");var t=f.closest("div.modal-body").height()-10;f.find("div").height(t);c.treegrid({iconCls:"icon-table",fit:true,singleSelect:true,loadMsg:"正在加载数据,请稍后...",rownumbers:false,border:true,noheader:true,idField:"id",treeField:"name",animate:true,onLoadSuccess:function(){e(this).exdatagrid("loaded")},onDblClickRow:function(){u()}});c.treegrid("loading");e.ajax({type:"POST",url:r,data:n,success:function(t){f.bs_dialog("hideLoading");if(typeof t=="string"){e.messager.alert("",t)}else{ReCorventColumnFormatter(t.columns);c.exdatagrid({columns:t.columns,frozenColumns:t.frozenColumns});c.treegrid("loadData",m("id",t.rows))}}})}});f.bs_dialog("open")};e.fn.showtreeandgridref=function(t){var a=e.data(this[0],"reftext");if(!a){return}var i=a.options;var r=i.gridurl;var n=i.gridparams;var o=i.refwidth;var s=i.refheight;var l=i.title;var d=i.treeurl;var f=i.treeparams;var c=i.isTAGSelectFirst;var u=i.treeandgridTitle;var g=i.treeandgridIcon;var v=e('<div class="row"></div>').appendTo("body");a.divref=v;var h=e('<div class="treeMin hidden tooltip-warning" data-rel="tooltip" data-original-title="点击展开">  <div> <button id="tree_expand" class="btn  no-border btn-toolbar "  ><i class="ace-icon fa fa-expand bigger-120"></i></button> </div> <h4  class="widget-title lighter smaller" style="color: white; padding-right: 10px; padding-left: 10px;">'+u+"</h4>  </div>").appendTo(v);var p=e('<div class="col-xs-12 col-sm-4 col-md-4 col-lg-3 tree-large xs-width-100"><div class="widget-box widget-color-green2 "> <div class="widget-header">   <i class="ace-icon fa '+g+' bigger-115 orange2"></i>&nbsp;<h4 id="treetitle" class="widget-title lighter smaller">'+u+'</h4> <div class="widget-toolbar no-border">  <button class="btn  no-border btn-toolbar tooltip-info compress" data-rel="tooltip" data-original-title="点击收缩" ><i class="ace-icon fa fa-compress bigger-120"></i></button>  <button class="btn  no-border btn-toolbar tooltip-info treeclose" data-rel="tooltip" data-original-title="关闭分类树" ><i class="ace-icon fa fa-close bigger-120"></i></button></div></div> <div class="widget-body" style="overflow: auto;"><div class="widget-main padding-8"> <ul></ul>    </div>  </div> </div></div>').appendTo(v);var x=e('<div class="col-xs-12 col-sm-8 col-md-8 col-lg-9 xs-width-100"></div>').appendTo(v);var m=e('<div class="col-sm-12  form-horizontal"></div>').appendTo(x);var w=e('<div class=""><div class="input-group input-icon"><input class="form-control" type="text" placeholder="'+i.serchWarterMark+'" style="border:1px solid #6fb3e0;"/>	<span class="input-group-btn">	<button  class="btn  btn-info btn-no-border" type="button" style="height: 34px;">过滤</button></span> <i class="ace-icon fa fa-filter" style="color:#6fb3e0;"></i></div></div>').appendTo(m);e('<div class="col-sm-12" style="height:10px;"></div>').appendTo(x);var y=w.find("input");var C=w.find("button");var _=e('<div class="" style="height:300px;"><div class="mx-datarid-c" ></div></div>').appendTo(x).find(">div");y.keydown(function(e){if(event.keyCode==13){C.trigger("click")}});C.click(function(){var t=y.val();var a=S.exdatagrid("options");if(t==""){a.source_Temp=a.source;b(S,1);return}var i=[];var r=S.exdatagrid("options").columns;if(!!r){e.each(r,function(t,a){e.each(a,function(e,t){if(!t.hidden){i.push(t.field)}})})}var n=S.exdatagrid("options").frozenColumns;if(!!n){e.each(n,function(t,a){e.each(a,function(e,t){if(!t.hidden){i.push(t.field)}})})}var a=S.exdatagrid("options");a.source_Temp=e.grep(a.source,function(a,r){var n=false;e.each(a,function(a,r){if(e.inArray(a,i)>-1&&(String(r).indexOf(t)>-1||String(r).indexOf(t.toString().toUpperCase())>-1||String(r).toUpperCase().indexOf(t.toString().toUpperCase())>-1)){n=true;return false}});return n});b(S,1)});var S=e("<table ></table>").appendTo(_);var k=p.find("div.widget-body");p.find("button.treeclose").on("click",function(t){e.smallscreen.hidetree(p)});p.find("button.compress").on("click",function(e){h.removeClass("hidden");p.addClass("hidden");x.addClass("treeMin_datagrid");if(S.hasClass("easyui_dg")){S.datagrid("resize")}});h.on("click",function(){p.removeClass("hidden");h.addClass("hidden");x.removeClass("treeMin_datagrid");if(S.hasClass("easyui_dg")){S.datagrid("resize")}});var T=p.find("ul");var z=function(){var a=S.exdatagrid("getSelected");if(a){v.bs_dialog("close");t.call(this,a)}else{e.messager.alert("","请选择一行数据!")}};var L=[{dom:'<button class="btn btn-sm btn-success btn-next mx-xs-quick" ><i class="ace-icon fa fa-check "></i><span class="">选入</span></button>',handler:function(){z()}}];if(i.qa_config){L.push({dom:'<button class="btn btn-sm btn-info2 btn-next" style="float:left"><i class="ace-icon fa fa-plus bigger-110"></i><span class="bigger-110">'+i.qa_config.title+"</span></button>",handler:function(){if(a.divref){a.divref.bs_dialog("close");a.divref.bs_dialog("destory")}i.qa_config.quickClick.call(i.qa_config)}})}v.bs_dialog({width:"lg",title:'<h5 style="margin-top:5px;margin-bottom:5px;"><i class="ace-icon fa fa-search orange bigger-120" style="margin-right:5px;"></i>'+l+"</h5>",buttons:L,onClose:function(){v.bs_dialog("destory")},onShow:function(){v.bs_dialog("showLoading","");var t=v.closest("div.modal-body").height();var a=t-m.height()-10;_.height(a);k.height(t-45);h.height(t);S.exdatagrid({iconCls:"icon-table",fit:true,singleSelect:true,loadMsg:"正在加载数据,请稍后...",rownumbers:true,border:true,noheader:true,pagination:true,onLoadSuccess:function(e){v.bs_dialog("hideLoading")},onDblClickRow:function(){z()}});e.ajax({type:"POST",url:d,data:f,success:function(t){if(typeof t=="string"){e.messager.alert("",t)}if(t.length-1<0){v.bs_dialog("hideLoading");return}else{T.bs_tree({data:t,onSelect:function(t){e.smallscreen.hidetree(p);S.exdatagrid("loading");e.ajax({type:"POST",url:r,data:e.extend({},n,{snode:t.id}),success:function(t){if(typeof t=="string"){e.messager.alert("",t)}else{if(S.exdatagrid("options").columns.length==0){ReCorventColumnFormatter(t.columns);ReCorventColumnFormatter(t.frozenColumns);S.exdatagrid({columns:t.columns,frozenColumns:t.frozenColumns})}y.val("");var a=S.exdatagrid("getPager");if(a){e(a).pagination({showPageList:true,pageNumber:0,pageSize:20,showRefresh:false,showPageList:false,onSelectPage:function(e,t){var a=S.exdatagrid("options");var i=a.source_Temp.length;if(i==0)return;var r=Math.ceil(i/20);if(e<=0)e=1;else if(e>r)e=r;b(S,e)}})}var i=S.exdatagrid("options");i.source=t.rows;i.source_Temp=t.rows;b(S,1)}}})}});if(c==true){T.bs_tree("selectFirst")}else{T.bs_tree("selectItem",c)}}},error:function(){S.exdatagrid("loaded")}})}});e.smallscreen.set_tree_p(p,v.bs_dialog("getdhbar"));v.bs_dialog("open")};var b=function(e,t){var a=20;var i=e.exdatagrid("options");if(!t){return}var r=(t-1)*a;var n={};if(t*a<=i.source_Temp.length){n.rows=i.source_Temp.slice(r,r+a);n.total=i.source_Temp.length}else{n.rows=i.source_Temp.slice(r);n.total=i.source_Temp.length}e.exdatagrid("loadData",n);e.exdatagrid("loaded")};function x(e){if(e.children==null||e.children.length<=0){return e.id}else{return x(e.children[0])}}var m=function(e,t){var a;var i=[];for(var r=0;r<t.length;r++){i.push(t[r])}var n=[];for(var r=0;r<i.length;r++){var o=i[r];if(!a){if(!o._parentId){n.push(o);i.remove(o);r--}}else{if(o._parentId==a){n.push(o);i.remove(o);r--}}}var s=[];for(var r=0;r<n.length;r++){s.push(n[r])}while(s.length){var l=s.shift();for(var r=0;r<i.length;r++){var o=i[r];if(o._parentId==l[e]){if(l.children){l.children.push(o)}else{l.children=[o]}s.push(o);i.remove(o);r--}}}return n}})(jQuery);(function(t){t.fn.toolbar=function(e,a){if(typeof e=="string"){var r=t.fn.toolbar.methods[e];if(r){return r(this,a)}}e=e||{};return this.each(function(){var a=t.data(this,"toolbar");if(a){t.extend(a.options,e)}else{a=t.data(this,"toolbar",{options:t.extend({},t.fn.toolbar.defaults,e)})}var r=a.options;r.buttons=o(r.type);r.OnInitTB.call(this,r.buttons);n(this)})};t.fn.toolbar.defaults={type:"BaseSet",OnInitTB:function(){},OnInitEnd:function(){}};var n=function(n){var e=t(n);e.empty();var a=t.data(n,"toolbar");e.addClass("mx-toolbar-c  width-100");a.tbc=t('<div class="mx-toolbar"></div>').appendTo(e);var o=a.options;o.buttons=o.buttons.sort(function(t,n){if(t.iorder<n.iorder){return-1}if(t.iorder>n.iorder){return 1}return 0});t.each(o.buttons,function(n,e){var o=t(e.dom);if(!o.hasClass("btn-toolbar")){o.addClass("btn-toolbar")}a.tbc.append(o)});o.OnInitEnd.call(n)};var e=function(n){var e=t.data(n,"toolbar");var a=e.options;e.menuBox=t('<div class="dropdown dropdown-preview"  style="width: 120px; display: none; position: absolute; z-index: 9999;"><ul class="dropdown-menu dropdown-yellow"><li ><a href="javascript:void(0);"  tabindex="-1"><i class="ace-icon fa fa-level-up green" style="margin-right:5px;"></i>向上插行</a></li></ul></div>').appendTo(t("body")).unbind("mouseleave").bind("mouseleave",function(n){t(this).css({display:"none"})});t("body").on("contextmenu",function(n){var a=!n?window.event:n;if(a.button==2){var o=t(n.target);if(o.is("input")){return true}var r=e.menuBox;var i=n.clientX;var b=n.clientY;var s=t(document).scrollTop();if(b+r.height()+s>t(document).height()){b=n.clientY-r.height()+s}r.css({left:i,top:b+s,display:"block"});return false}}).on("click.toobarMenu",function(){e.menuBox.css({display:"none"})})};var a=function(t){};var o=function(t){var n=[];switch(t){case"BaseSetUnShow":n.push(r("btnExport"));n.push(r("btnSearch"));n.push(r("btnAdd"));n.push(r("btnEdit"));n.push(r("btnDel"));n.push(r("btnReLoad"));break;case"BaseSet":n=o("BaseSetUnShow");n.push(r("btnShow"));break;case"BaseSetWithSave":n=o("BaseSetUnShow");n.push(r("btnSave"));n.push(r("btnCancel"));break;case"BaseSetWithSwitch":n=o("BaseSetUnShow");n.push(r("btnSwitch"));break;case"BaseSetWithSaveAndSwitch":n=o("BaseSetWithSave");n.push(r("btnSwitch"));break;case"BillUnWithPrint":n=o("BaseSetWithSaveAndSwitch");n.push(r("btnCheck"));n.push(r("btnVoid"));break;case"Bill":n=o("BillUnWithPrint");n.push(r("btnPrint"));break;case"Rpt":n.push(r("btnExport"));n.push(r("btnSearch"));n.push(r("btnReLoad"));break;case"RptWithShow":n=o("Rpt");n.push(r("btnShow"));break}return n};var r=function(t){switch(t){case"btnPrint":return{id:t,dom:'<button id="btnPrint" href="#" class="btn btn-toolbar btn-white btn-info no-border"  onclick="showPrint()" authtag="IsPrintAuth" settag="read"><i class="ace-icon fa fa-print green bigger"></i>打印</button>',iorder:10};break;case"btnExport":return{id:t,dom:'<button id="btnExport" href="#" class="btn btn-toolbar btn-white btn-info no-border"  onclick="OutExcel()" authtag="IsExportAuth" settag="read"><i class="ace-icon fa fa-file-excel-o green bigger"></i>输出</button>',iorder:20};break;case"btnAdd":return{id:t,dom:'<button id="btnAdd" href="#" class="btn btn-toolbar btn-white btn-purple no-border"  onclick="Add()" authtag="IsAddAuth" settag="read"><i class="ace-icon fa fa-plus blue bigger"></i>增加</button>',iorder:40};break;case"btnEdit":return{id:t,dom:'<button id="btnEdit" href="#" class="btn btn-toolbar btn-white btn-purple no-border"  onclick="Edit()" authtag="IsModifyAuth" settag="read"><i class="ace-icon fa fa-edit orange bigger"></i>修改</button>',iorder:50};break;case"btnDel":return{id:t,dom:'<button id="btnDel" href="#" class="btn btn-toolbar btn-white btn-warning no-border"  onclick="Delete()" authtag="IsDeleteAuth" settag="read"><i class="ace-icon fa fa-remove red bigger"></i>删除</button>',iorder:60};break;case"btnCopy":return{id:t,dom:'<button id="btnCopy" href="#" class="btn btn-toolbar btn-white btn-purple no-border"  onclick="Copy()" authtag="IsAddAuth" settag="read"><i class="ace-icon fa fa-copy blue bigger"></i>复制</button>',iorder:61};break;case"btnSave":return{id:t,dom:'<button id="btnSave" href="#" class="btn btn-toolbar btn-white btn-success no-border "  onclick="Save()" authtag="IsAddAuth,IsModifyAuth" settag="modify"><i class="ace-icon fa fa-save green bigger"></i>保存</button>',iorder:70};break;case"btnCancel":return{id:t,dom:'<button id="btnCancel" href="#" class="btn btn-toolbar btn-white btn-danger no-border "  onclick="Cancel()" authtag="IsAddAuth,IsModifyAuth" settag="modify"><i class="ace-icon fa fa-reply red2 bigger"></i>取消</button>',iorder:80};break;case"btnCheck":return{id:t,dom:'<button id="btnCheck" href="#" class="btn btn-toolbar btn-white btn-success no-border"  onclick="SetCheck()" authtag="IsVerifyAuth" settag="read"><i class="ace-icon fa fa-check green bigger"></i>审核</button>',iorder:90};break;case"btnVoid":return{id:t,dom:'<button id="btnVoid" href="#" class="btn btn-toolbar btn-white btn-inverse no-border"  onclick="SetVoid()" authtag="IsVoidAuth" settag="read"><i class="ace-icon fa fa-trash grey bigger"></i>作废</button>',iorder:100};break;case"btnSearch":return{id:t,dom:'<button id="btnSearch" href="#" class="btn btn-toolbar btn-white btn-pink no-border"  onclick="ShowSearch()" authtag="" settag="read"><i class="ace-icon fa fa-search green bigger"></i>查询</button>',iorder:110};break;case"btnSwitch":return{id:t,dom:'<button id="btnSwitch" href="#" class="btn btn-toolbar btn-white btn-info no-border"  onclick="SwitchView()" authtag="" settag="read"><i class="ace-icon fa fa-exchange green bigger"></i>切换</button>',iorder:120};break;case"btnShow":return{id:t,dom:'<button id="btnShow" href="#" class="btn btn-toolbar btn-white btn-purple no-border"  onclick="View()" authtag="" settag="read"><i class="ace-icon fa fa-credit-card green bigger"></i>查看</button>',iorder:130};break;case"btnReLoad":return{id:t,dom:'<button id="btnReLoad" href="#" class="btn btn-toolbar btn-white btn-success no-border"  onclick="SearchData(true)" authtag="" settag="read"><i class="ace-icon fa fa-refresh light-blue bigger"></i>刷新</button>',iorder:150};break;case"btnPageConfig":return{id:t,dom:'<div class="btn-group " id="btnPageConfig"><button data-toggle="dropdown" href="#" class="btn btn-toolbar btn-white btn-info no-border dropdown-toggle"   authtag="" settag="read"><i class="ace-icon fa fa-gear green bigger"></i>配置<i class="ace-icon fa fa-angle-down icon-on-right"></i></button><ul class="dropdown-menu"><li id="btnTableConfig">	<a href="#" onclick="tableConfig()"><i class="ace-icon fa fa-table orange" style="margin-right:5px;"></i>表格配置</a></li><li id="btnFormConfig"><a href="#" onclick="formConfig()"><i class="ace-icon fa fa-th orange" style="margin-right:5px;"></i>表单配置</a></li></ul></div> ',iorder:400};break;case"btnImport":return{id:t,dom:'<button id="btnImport" href="#" class="btn btn-toolbar btn-white btn-info no-border"  onclick="Import()" authtag="IsAddAuth" settag="read"><i class="ace-icon fa fa-level-down green bigger"></i>导入</button>',iorder:325};break;default:return null;break}};var i=function(t,n,e){var a='<div id="'+t+'" style="display:none;" authtag="'+n+'"></div>';return{id:t,dom:a,iorder:e}};t.fn.toolbar.methods={insertByID:function(t,n){c(t[0],n)},removeByID:function(t,n){b(t[0],n)},hiddenByID:function(t,n){s(t[0],n)},insert:function(t,n){d(t[0],n)},insertSP:function(t,n){d(t[0],i("","",n))},initTB:function(t){n(t[0])}};var b=function(n,e){var a=t.data(n,"toolbar");var o=a.options;o.buttons=t.grep(o.buttons,function(n,a){return t.inArray(n.id,e)==-1})};var s=function(n,e){var a=t.data(n,"toolbar");var o=a.options;var r=t(n);t.each(e,function(t,n){r.find("#"+n).addClass("hidden")})};var c=function(n,e){var a=t.data(n,"toolbar");var o=a.options;var i=r(e);if(i){o.buttons.push(i)}};var d=function(n,e){var a=t.data(n,"toolbar");var o=a.options;o.buttons.push(e)}})(jQuery);(function(e){e.fn.objcondition=function(a,t){if(typeof a=="string"){var n=e.fn.objcondition.methods[a];if(n){return n(this,t)}}a=a||{};return this.each(function(){var t=e.data(this,"objcondition");if(t){e.extend(t.options,a)}else{t=e.data(this,"objcondition",{options:e.extend({},e.fn.objcondition.defaults,a)})}r(this,false)})};e.fn.objcondition.defaults={width:650,height:400,title:"查询条件列表",iconCls:"icon-search",objid:"",IsFristLoad:true,closed:true,ispro:false,isshowtotal:false,searchBar:"",OnFirstLoaded:function(e){},OnLoaded:function(e){},LoadingObjCondition:function(e){},onClose:function(e){},onPlanSearch:function(e){},showtype:1,OnValueChanged:function(e){},OnTotalValueChanged:function(e){},currentCon:""};e.fn.objcondition.methods={ShowSearch:function(e,a){return r(e[0],a==undefined?true:a)},GetConStr:function(a){var t=e.data(a[0],"objcondition").options;t.currentCon=S(a[0]);return t.currentCon},getCurrentCon:function(a){var t=e.data(a[0],"objcondition").options;return t.currentCon},setCurrentCon:function(a,t){var n=e.data(a[0],"objcondition").options;n.currentCon=t},GetTotalValue:function(e,a){return y(e[0],a)},setTotalValue:function(e,a){C(e[0],a.field,a.value)},setConValue:function(e,a){v(e[0],a[0],a[1],true)},setSecondConValue:function(e,a){v(e[0],a[0],a[1],false)},setItem:function(e,a){x(e[0],a.field,a.item)},getConVal:function(e,a){return m(e[0],a,true)},getSecondConVal:function(e,a){return m(e[0],a,false)}};var a=function(a){var t=e.data(a,"objcondition").options;e(a).addClass("objcondition_Me hidden mx-dialog-c");t.hasLoad=false;t.ForSearc_currentField="";t.bCanEdit=true;t.ForSearch_currentRow=-1;"";var n=t.isshowtotal?'<div  class="mx-form-c"><div  class="accordion-style1 panel-group" style="margin-bottom:0px;"><div class="panel panel-default"><div class="panel-heading"><h4 class="panel-title"><a class="accordion-toggle collapsed" data-toggle="collapse"  href="#objcondition_total"><i class="ace-icon fa fa fa-angle-right bigger-110" data-icon-hide="ace-icon fa fa-angle-down" data-icon-show="ace-icon fa fa-angle-right"></i> 分组统计设置</a> </h4></div><div class="panel-collapse collapse in" id="objcondition_total"><div class="panel-body"><div name="tcheckboxSearchQuery"></div></div></div></div></div></div> ':" ";e(a).append(' <div class="" ><div class="col-sm-12"><div class="mx-datarid-c"  style="height:250px;"><table name="tbSearchQuery" ></table></div>'+n+"</div></div>");t["tcheckboxSearchQuery"]=e(a).find('div[name="tcheckboxSearchQuery"]');t["tbSearchQuery"]=e(a).find('table[name="tbSearchQuery"]');e(a).removeClass("hidden");if(t.showtype==1){var o=[];o.push({dom:'<button class="btn btn-sm btn-primary mx-xs-quick"><i class="ace-icon fa fa-search "></i><span class="">确定</span></button>',handler:function(){if(t.ForSearch_currentRow>=0){t.bCanEdit=true;t.tbSearchQuery.datagrid("endEdit",t.ForSearch_currentRow)}if(p(t)){s(a);e(a).bs_dialog("close");t.onClose.call(a,true);var n=e(t.searchBar);n.find(".searchPlan-Div").removeClass("check")}}});var i='<li><a href="#" data-tag="highmode"><i class="ace-icon fa fa-check-square-o orange highmode hidden"></i>高级模式</a></li>';if(t.ispro){i=""}o.push({dom:'<div  class="btn-group pull-left"><button class="btn btn-success dropdown-toggle" aria-expanded="false" data-toggle="dropdown">更多操作<i class="ace-icon fa fa-angle-down icon-on-right"></i></button><ul class="dropdown-menu user-menu ">'+i+'   <li><a href="#"  data-tag="reset">重置查询条件</a>	</li><li class="divider"></li><li><a href="#" class="hidden" data-tag="showconfig">显示配置</a>	</li><li> <a href="#" data-tag="addplan">另存为查询方案</a></li><li><a href="#" data-tag="delplan">删除查询方案</a></li></ul></div>',handler:function(){}});e(a).bs_dialog({title:' <h5 style="margin-top:5px;margin-bottom:5px;"><i class="ace-icon fa fa-search fa-2x green" style="margin-right:5px;"></i>查询条件</h5>',buttons:o,onBeforeOpen:function(){if(!t.hasLoadData){t.tbSearchQuery.datagrid({url:"/SysBase/ObjConditionForSearch/GetData",queryParams:{objid:t.objid},border:true});t.hasLoadData=true}},onShow:function(){if(e.browser.useapp){var n=e(a).closest("div.modal-body").height()-10;if(t.isshowtotal){n-=30}e(a).find("div.mx-datarid-c").height(n)}t.tbSearchQuery.datagrid("resize")}});e(a).closest("div.modal-content").find(".modal-footer>.btn-group>ul.dropdown-menu>li").on("click",function(){var n=e(this).find(">a").data("tag");switch(n){case"highmode":if(t.highmode){e(this).find(">i.highmode").addClass("hidden");g(a,false)}else{e(this).find(">i.highmode").removeClass("hidden");g(a,true)}break;case"showconfig":t.divConfig.bs_dialog("open");var o=t.divConfig.find("select");if(o.find(">option").length<=0){l(t)}break;case"addplan":if(t.ForSearch_currentRow>=0){t.bCanEdit=true;t.tbSearchQuery.datagrid("endEdit",t.ForSearch_currentRow)}if(p(t)){s(a);t.addplandialog.bs_dialog("open")};break;case"delplan":t.delplandialog.bs_dialog("open");break;case"reset":t.tbSearchQuery.datagrid("load",{objid:t.objid});l(t);break}})}};var t=function(a){var t=e.data(a,"objcondition").options;t.divConfig=e('<div class="hidden"></div>').appendTo(e("body"));var n=e('<div class="row"><div class="col-sm-12"><select  multiple="multiple"></select></div></div>').appendTo(t.divConfig);t.divConfig.removeClass("hidden");t.divConfig.bs_dialog({width:"",title:' <h5 style="margin-top:5px;margin-bottom:5px;"><i class="ace-icon fa fa-cog fa-2x orange" style="margin-right:5px;"></i>查询条件显示配置</h5>',buttons:[{dom:'<button class="btn btn-sm btn-primary"><i class="ace-icon fa fa-save bigger-110"></i><span class="bigger-110">保存</span></button>',handler:function(){j(a);t.divConfig.bs_dialog("close")}}]})};var n=function(a){var t=e.data(a,"objcondition").options;t["addplandialog"]=e('<div class="row hidden"><div class="col-sm-12 form-horizontal"><div class="form-group col-sm-12"><label class="no-padding-right control-label col-xs-12 col-sm-5 col-md-4 col-lg-3">快捷查询</label><div class="col-xs-12 col-sm-7 col-md-8 col-lg-9"><select class="width-100" name="addplandialog_seplan"></select></div></div><div class="form-group col-sm-12"><label class="no-padding-right control-label col-xs-12 col-sm-5 col-md-4 col-lg-3">方案名称</label><div class="col-xs-12 col-sm-7 col-md-8 col-lg-9"><input  type="text" class="width-100" name="addplandialog_planname"/></div></div></div></div>').appendTo(e("body"));t["addplandialog_seplan"]=t.addplandialog.find("select[name='addplandialog_seplan']").on("change",function(a,n){if(e(this).val()==""){t.addplandialog_planname.val("");t.addplandialog_planname.removeAttr("readonly");t.addplandialog_planname.focus()}else{t.addplandialog_planname.val(e(this).val());t.addplandialog_planname.attr("readonly","readonly")}});t["addplandialog_planname"]=t.addplandialog.find("input[name='addplandialog_planname']");t.addplandialog.removeClass("hidden");t.addplandialog.bs_dialog({width:"",title:' <h5 style="margin-top:5px;margin-bottom:5px;"><i class="ace-icon fa fa-pencil fa-2x green" style="margin-right:5px;"></i>编辑查询方案</h5>',buttons:[{dom:'<button class="btn btn-sm btn-primary"><i class="ace-icon fa fa-save bigger-110"></i><span class="bigger-110">保存</span></button>',handler:function(){var t=e.data(a,"objcondition").options;if(t.addplandialog_planname.val()!=""){var n=S(a);if(n==""||n==null){e.messager.alert("保存查询方案","查询条件不能为空!","warning");return false}e.ajax({type:"POST",url:"/SysBase/ObjConditionForSearch/SaveObjConditionPlan",data:{objid:t.objid,PlanName:t.addplandialog_planname.val(),Search:n},success:function(n){if(n===""){t.addplandialog_planname.val("");t.addplandialog.bs_dialog("close");c(a)}else e.messager.alert("保存查询方案",n,"warning")},error:function(){e.messager.alert("保存查询出错")}})}else{e.messager.alert("查询方案名称不能为空");t.addplandialog_planname.focus()}}}],onClose:function(){t.addplandialog_planname.val("")},onShow:function(){t.addplandialog_seplan.find("option").remove();e('<option value="" selected="selected">--新增查询方案--</option>').appendTo(t.addplandialog_seplan);e.each(t.PlanData,function(a,n){if(n.ispublic==true){return true}e('<option value="'+n.text+'">'+n.text+"</option>").appendTo(t.addplandialog_seplan)});t.addplandialog_planname.removeAttr("readonly");t.addplandialog_planname.focus()}});t["delplandialog"]=e('<div class="row hidden"><div class="col-sm-12 form-horizontal"><div class="form-group col-sm-12"><label class="no-padding-right control-label col-xs-12 col-sm-5 col-md-4 col-lg-3">查询方案</label><div class="col-xs-12 col-sm-7 col-md-8 col-lg-9"><select class="width-100" name="delplandialog_seplan"></select></div><input name="delplandialog_planid" type="hidden"/></div></div></div>').appendTo(e("body"));t["delplandialog_seplan"]=t.delplandialog.find("select[name='delplandialog_seplan']");t["delplandialog_planid"]=t.delplandialog.find("input[name='delplandialog_planid']");t.delplandialog.removeClass("hidden");t.delplandialog.bs_dialog({width:"",title:' <h5 style="margin-top:5px;margin-bottom:5px;"><i class="ace-icon fa fa-flash fa-2x orange" style="margin-right:5px;"></i>删除查询方案</h5>',buttons:[{dom:'<button class="btn btn-sm btn-danger"><i class="ace-icon fa fa-minus bigger-110"></i><span class="bigger-110">确认删除</span></button>',handler:function(){var n=e.data(a,"objcondition").options;e.ajax({type:"POST",url:"/SysBase/ObjConditionForSearch/DelObjConditionPlan",data:{ID:n.delplandialog_seplan.val()},success:function(n){if(n.error){e.messager.alert("删除查询方案",n.error,"warning")}else{c(a);t.delplandialog.bs_dialog("close")}}})}}],onShow:function(){t.delplandialog_seplan.find("option").remove();e.each(t.PlanData,function(a,n){if(n.ispublic==true){return true}e('<option value="'+n.value+'">'+n.text+"</option>").appendTo(t.delplandialog_seplan)})}})};var o=function(a){var t=e.data(a,"objcondition").options;t.tbSearchQuery.datagrid({iconCls:"icon-table",fit:true,singleSelect:true,loadMsg:"正在加载查询条件列表,请稍后...",sortName:"iItemOrder",sortOrder:"asc",idField:"AutoID",rownumbers:true,fitColumns:false,border:true,autoRowHeight:false,bodyView:true,noheader:true,columns:[[{title:"前括号",halign:"center",field:"FBrakcet",width:50,formatter:function(e,a,t){if(e==0){return"无"}else{var n="";for(i=0;i<e;i++){n+="("}return n}}},{title:"条件名称",halign:"center",field:"cItemName",width:100,styler:function(e,a,t){if(a.IsValueRequired){return"color:blue;"}else{}}},{title:"关系符",halign:"center",field:"ObjCon",width:80},{title:"起始值",halign:"center",field:"ConValue",width:150,formatter:b},{title:"结束值",halign:"center",field:"ConValueSecond",width:150,formatter:h,styler:function(e,a,t){if(a.IsDoubleValue!=true){}}},{title:"后括号",halign:"center",field:"ABrakcet",width:50,formatter:function(e,a,t){if(e==0){return"无"}else{var n="";for(i=0;i<e;i++){n+=")"}return n}}},{title:"条件逻辑",halign:"center",field:"ConLogic",width:60}]],onClickCell:function(a,n,o){if(t.ForSearc_currentField!=""&&t.ForSearc_currentField!=n){t.bCanEdit=true;t.tbSearchQuery.datagrid("endEdit",t.ForSearch_currentRow)}if(t.ForSearch_currentRow>=0&&t.ForSearch_currentRow!=a){t.bCanEdit=true;t.tbSearchQuery.datagrid("endEdit",t.ForSearch_currentRow)}t.tbSearchQuery.datagrid("selectRow",a);var i=t.tbSearchQuery.datagrid("getSelected");if(n!="cItemName"&&t.bCanEdit&&!i.bReadOnly&&(n!="ConValueSecond"||i.IsDoubleValue)){var r=t.tbSearchQuery.datagrid("options").columns[0];e.each(r,function(e,a){a.editor=""});var l=t.tbSearchQuery.datagrid("getColumnOption",n);if(n=="ConValueSecond"){l.editor="EditorsForSearchQuery_ConValue"}else{l.editor="EditorsForSearchQuery_"+n}t.ForSearch_currentRow=a;t.ForSearc_currentField=n;t.bCanEdit=false;t.tbSearchQuery.datagrid("beginEdit",a)}},onAfterEdit:function(e,n,o){t.OnValueChanged.call(a,t.rdata[e])},loadFilter:function(n){var o=e(t.searchBar);o.find(".barsearch").remove();var i=false;e.each(n,function(e,n){if(n.isShowInBar){i=true}if(n.iRefStyle==6){n.append={reftext_initui:t.reftext_initui,textpath:"",item:null,item2:null,valuepath:""}}if(n.iRefStyle==7){n.append={item:null,item2:null}}t.LoadingObjCondition.call(this,n);if(n.isShowInBar){f(a,t.searchBar,n);if(n.ConValue!=""){u(n)}}});if(i){}c(a);if(t.isshowtotal){var r=e.grep(n,function(e,a){return e.bTotal==true});if(r.length>0){t.tdata=r;var l="";e.each(r,function(e,a){var t=a.bDefTotal?'checked="checked"':"";l+='<label style="padding:5px;"><input class="ace" name="'+a.cFieldName+'" type="checkbox" '+t+' /><span class="lbl" style="margin-left:3px;">'+a.cItemName+"</span></label>"});t.tcheckboxSearchQuery.empty();t.tcheckboxSearchQuery.append(l);t.tcheckboxSearchQuery.find("input:checkbox.ace").on("change",function(){t.OnTotalValueChanged.call(a,{cFieldName:e(this).attr("name"),value:e(this).prop("checked")})})}}var d=e.grep(n,function(e,a){return e.bTotal==false});t.rdata=d;if(!t.hasLoad){t.hasLoad=true;t.OnFirstLoaded.call(this,n)}t.hasLoad=true;t.OnLoaded.call(this,n);return{rows:d,total:d.length}}});g(a,false)};function r(i,r){var l=e.data(i,"objcondition").options;if(!l["tbSearchQuery"]){a(i);t(i);n(i);o(i)}if(r){e(i).bs_dialog("open")}if(l.IsFristLoad){if(!l.hasLoadData){l.tbSearchQuery.datagrid({url:"/SysBase/ObjConditionForSearch/GetData",queryParams:{objid:l.objid},border:true});l.hasLoadData=true}}}var l=function(a){e.ajax({type:"POST",url:"/SysBase/ObjConditionForSearch/GetConfigData",data:{objid:a.objid},success:function(t){if(!t.rows){return}if(t.rows.length>0){var n=a.divConfig.find("select");e.each(t.rows,function(e,a){var t="";if(a.isShow){t='selected="selected"'}n.append(' <option value="'+a.AutoID+'" '+t+" >"+a.cItemName+"</option>")});var n=a.divConfig.find("select").bootstrapDualListbox({selectedListLabel:"正在显示条件",nonSelectedListLabel:"可用条件",selectorMinimalHeight:250})}},error:function(){e.messager.alert("查询出错","查询条件出错!","warring")}})};var d=function(a){e("#planTitle")?e("#planTitle").remove():"";var t={};var n=[];t.value="";t.text="--新建查询--";t.ispublic=false;if(a=="add"){n.push(t)}else{e("#fastSearchName").attr("readonly","readonly")}var o=JSON.parse(JSON.stringify(planData));e.each(o,function(e,a){if(a.ispublic==false)n.push(a)});e("#fastSearchSelect").combobox({data:n,valueField:"value",textField:"text",editable:false,onSelect:function(t){if(t){if(t.value!=""&&t.value!=null){e("#fastSearchName").val(t.text);e("#fastSearchName").attr("readonly","readonly");e("#planTitle")?e("#planTitle").remove():"";e("#planID").val(t.value);if(a=="add"){e("#fastSearchName").parent().parent().parent().append('<<tr id="planTitle" ><td colspan="2" style="color: red; font-size: 14px;">覆盖快捷查询:'+t.text+"</td></tr>")}else{e("#fastSearchName").parent().parent().parent().append('<<tr id="planTitle" ><td colspan="2" style="color: red; font-size: 14px;">删除快捷查询:'+t.text+"</td></tr>")}}else{e("#planTitle").remove();e("#fastSearchName").val("");e("#fastSearchName").removeAttr("readonly");e("#fastSearchName").focus()}}}}).combobox("setValue",n[0].value);if(a=="remove"){e("#fastSearchName").val(n[0].text);e("#planID").val(n[0].value);e("#fastSearchName").parent().parent().parent().append('<<tr id="planTitle" ><td colspan="2" style="color: red; font-size: 14px;">删除快捷查询:'+n[0].text+"</td></tr>")}e("#fastSearchName").focus()};var c=function(a){var t=e.data(a,"objcondition").options;var n=e(t.searchBar);n.find(".sPlan").remove();e.ajax({type:"POST",url:"/SysBase/ObjConditionForSearch/GetObjConditionPlan",data:{objid:t.objid},success:function(o){n.find(".sPlan").remove();if(e.type(o)==="string"){e.messager.alert("数据查询",o,"warning");return}t["PlanData"]=o;if(o.length>0){var i=e('<div class="sPlan inline" style="margin-right:15px;"><label style="margin-right:5px;">查询方案</label><select class="form-control" style="width:150px;"></select></div>').prependTo(n).find("select");i.append('<option value="" selected="selected">默认查询</option>');e.each(o,function(e,a){i.append('<option value="'+a.value+'">'+a.text+"</option>")});i.on("change",function(){var o=e(this).val();if(o==""){n.find(".barsearch").removeClass("hidden");var i=S(a);t.currentCon=i}else{n.find(".barsearch").addClass("hidden");t.currentCon=o}t.onPlanSearch.call(a,t.currentCon)});if(e.smallscreen){e.smallscreen.set_searchbar_av()}}},error:function(e){n.find(".sPlan").remove();alert("删除失败")}})};var s=function(a){var t=e.data(a,"objcondition").options;if(!t.hasLoad){return}if(t.rdata){e.each(t.rdata,function(e,a){if(a.isShowInBar){u(a)}})}else{return}};var u=function(e){if(!e["searchBarDom"]){return}if(e["searchBarDom"].length>0){var a=e["searchBarDom"];var t=e.ConValue;switch(e.iRefStyle){case 0:a.val(t);break;case 1:a.prop("checked",t);break;case 2:a.combobox("setValue",t);break;case 3:a.combobox("setValue",t);break;case 4:a.mxdate("setValue",t);break;case 5:a.mxdate("setValue",t);break;case 6:a.reftext("SetItem",e.append.item);break;case 7:a.combotree("setValue",t);break;case 41:a.mxdate("setValue",t);break;default:break}}};var f=function(a,t,n){if(t==""){return}var o=e(t);if(o.length<=0){return}var i=e('<div class="barsearch inline" style="margin-right:15px;"><label style="margin-right:5px;">'+n.cItemName+"</label></div>").appendTo(o);var r='<input type="text" class="form-control" iRefStyle="'+n.iRefStyle+'" style="width:200px;"/>';var l;switch(n.iRefStyle){case 0:l=e(r).appendTo(i);l.on("change",function(){e(a).objcondition("setConValue",[n.cFieldName,e(this).val()])});break;case 1:r='<input type="checkbox">';l=e(r).appendTo(i);break;case 2:l=e(r).appendTo(i);var d={editable:true,valueField:"Value",textField:"Text",data:n.ItemSource,onSelect:function(t){e(a).objcondition("setConValue",[n.cFieldName,t]);var o=e.data(a,"objcondition").options;o.onClose.call(a,true)}};if(n.combobox_param){e.extend(d,n.combobox_param)}l.ex_combobox(d);break;case 3:l=e(r).appendTo(i);var d={editable:false,valueField:"Value",textField:"Text",data:n.ItemSource,onSelect:function(t){e(a).objcondition("setConValue",[n.cFieldName,t.Value]);var o=e.data(a,"objcondition").options;o.onClose.call(a,true)}};if(n.combobox_param){e.extend(d,n.combobox_param)}l.ex_combobox(d);break;case 4:l=e(r).appendTo(i);l.mxdate({onSelect:function(t){e(a).objcondition("setConValue",[n.cFieldName,t]);var o=e.data(a,"objcondition").options;o.onClose.call(a,true)}});break;case 5:l=e(r).appendTo(i);l.mxdate({onSelect:function(t){e(a).objcondition("setConValue",[n.cFieldName,t]);var o=e.data(a,"objcondition").options;o.onClose.call(a,true)}});break;case 6:l=e(r).appendTo(i);var c={inittag:n.cFieldName,initui:n.append.reftext_initui,OnSelectItem:function(t){var o=n.ConValue;var i=e(this).reftext("GetValue");if(o!=i){e(a).objcondition("setConValue",[n.cFieldName,t]);var r=e.data(a,"objcondition").options;r.onClose.call(a,true)}}};if(n.reftext_param){e.extend(c,n.reftext_param)}l.reftext(c);var d=l.reftext("options");n.append.textpath=d.textpath;n.append.valuepath=d.valuepath;break;case 7:l=e(r).appendTo(i);if(!n.append){n.append={}}l.ex_combotree({editable:false,data:n.ItemSource,showsearch:true,onSelect:function(t){var o=n.ConValue;if(o!=t.id){if(n.append){n.append.item=t}e(a).objcondition("setConValue",[n.cFieldName,t.id]);var i=e.data(a,"objcondition").options;i.onClose.call(a,true)}}});break;case 41:l=e(r).appendTo(i);l.mxdate({onSelect:function(t){e(a).objcondition("setConValue",[n.cFieldName,t])}});break;default:break}n["searchBarDom"]=l};function p(a){var t=true;if(a.rdata){var n=e.grep(a.rdata,function(e,a){return e.IsValueRequired});e.each(n,function(e,a){if(a.ConValue==null||a.ConValue==""){alert("必须输入 "+a.cItemName+" 的条件值，请输入后执行查询");t=false;return false}})}return t}function b(a,t,n){var o;switch(t.iRefStyle){case 0:o=a;break;case 1:o=a==true||a=="true"?"是":"否";break;case 2:e.each(t.ItemSource,function(e,t){if(t.Value==a){o=t.Text;return false}});break;case 3:e.each(t.ItemSource,function(e,t){if(t.Value==a){o=t.Text;return false}});break;case 4:o=a;break;case 5:o=a;break;case 6:if(t.append.item&&t.append.textpath!=""){o=t.append.item[t.append.textpath]}else{o=""};break;case 7:if(t.append.item){o=t.append.item.text}else{o=""};break;default:o=a;break}return o}function h(e,a,t){if(a.iRefStyle==6){var n;if(a.append.item2&&a.append.textpath!=""){n=a.append.item2[a.append.textpath]}else{n=""}return n}else if(a.iRefStyle==7){var n;if(a.append.item2){n=a.append.item2.text}else{n=""}return n}else{return b(e,a,t)}if(a.iRefStyle==7){var n;if(e&&e.text){n=e.text}else{n=""}return n}}function g(a,t){var n=e.data(a,"objcondition").options;n["highmode"]=t;if(t){n.tbSearchQuery.datagrid("showColumn","FBrakcet");n.tbSearchQuery.datagrid("showColumn","ABrakcet");n.tbSearchQuery.datagrid("showColumn","ConLogic");e(e(a).parents("div.modal-dialog")).addClass("modal-lg");n.tbSearchQuery.datagrid("resize")}else{n.tbSearchQuery.datagrid("hideColumn","FBrakcet");n.tbSearchQuery.datagrid("hideColumn","ABrakcet");n.tbSearchQuery.datagrid("hideColumn","ConLogic");e(e(a).parents("div.modal-dialog")).removeClass("modal-lg");n.tbSearchQuery.datagrid("resize")}}function m(a,t,n){var o=e.data(a,"objcondition").options;if(!o.hasLoad){return""}if(o.currentCon&&o.currentCon!=""){var i=o.currentCon.replace(/\*#/g,"<").replace(/\~\^/g,">");var r=e(i);var l=r.find('condition[fieldname="'+t+'"]');if(l&&l.length>0){if(n){return l.attr("convalue").replace(/"/g,"")}else{return l.attr("convaluesecond").replace(/"/g,"")}}}else{return""}}function v(a,t,n,o){var i=e.data(a,"objcondition").options;if(!i.hasLoad){return}if(i.rdata){var r=e.grep(i.rdata,function(e,a){return e.cFieldName===t});if(!r||r.length<=0){return}if(r[0].iRefStyle==6){if(o){r[0].append.item=n;r[0].ConValue=n==null?null:n[r[0].cFieldName]}else{r[0].append.item2=n;r[0].ConValueSecond=n==null?null:n[r[0].cFieldName]}}else{if(o){r[0].ConValue=n}else{r[0].ConValueSecond=n}}if(r[0].isShowInBar){u(r[0])}var l=i.tbSearchQuery;l.datagrid("refreshRow",l.datagrid("getRowIndex",r[0]));i.OnValueChanged.call(a,r[0])}else{return}}function x(a,t,n){var o=e.data(a,"objcondition").options;if(!o.hasLoad){return}if(o.rdata){var i=e.grep(o.rdata,function(e,a){return e.cFieldName===t});if(!i||i.length<=0){return}e.extend(i[0],n);if(n["ConValue"]||n[""]){var r=o.tbSearchQuery;r.datagrid("refreshRow",r.datagrid("getRowIndex",i[0]));o.OnValueChanged.call(a,i[0])}}else{return}}function S(a){var t=e.data(a,"objcondition").options;if(!t.hasLoad){return""}if(t.rdata){var n=e.grep(t.rdata,function(e,a){return!((e.ConValue==null||e.ConValue=="")&&(e.ConValueSecond==null||e.ConValueSecond==""))});var o=e("<conditions></conditions>");o.attr("isprocedure",t.ispro?"true":"false");e.each(n,function(a,i){if(i.bSetWhere){i.ReWhereStr=t.ReSetWhere.call(this,i)}var r=e("<condition></condition>");if(!i.IsProcedure){r.attr("abrakcet",i.ABrakcet);r.attr("fbrakcet",i.FBrakcet);r.attr("objcon",i.ObjCon);r.attr("notnull",i.NotNull?"true":"false");if(i.bSetWhere){r.attr("rewherestr",i.ReWhereStr)}if(a<n.length-1){r.attr("conlogic",i.ConLogic)}r.attr("convalue",k(i,false));if(i.IsDoubleValue){r.attr("convaluesecond",k(i,true))}}else{r.attr("convalue",i.ConValue);if(i.IsDoubleValue){r.attr("convaluesecond",i.ConValueSecond)}}r.attr("fieldname",i.cFieldName);o.append(r)})}if(t.ispro){e.each(t.tcheckboxSearchQuery.find("input:checkbox:checked"),function(a,t){var n=e("<condition></condition>");n.attr("fieldname",t.name);n.attr("istotal","true");o.append(n)})}if(o.find("condition").length>0){return o[0].outerHTML.replace(/</g,"*#").replace(/>/g,"~^")}else{return""}}function y(a,t){var n=e.data(a,"objcondition").options;if(!n.hasLoad){return false}if(n.currentCon&&n.currentCon!=""){var o=n.currentCon.replace(/\*#/g,"<").replace(/\~\^/g,">");var i=e(o);var r=i.find('condition[fieldname="'+t+'"]');if(r&&r.length>0){var l=r.attr("istotal");if(l=="true"){return true}}}return false}var C=function(a,t,n){var o=e.data(a,"objcondition").options;var i=o.tcheckboxSearchQuery.find("input:checkbox[name='"+t+"']");i.prop("checked",n)};function k(e,a){var t=a?e.ConValueSecond:e.ConValue;var n=e.iDataType;if(t==null){return""}if(n==5&&e.ObjCon!="日期范围"&&t){if(!a){return'"'+t+" "+'00:00:00"'}else{return'"'+t+" "+'23:59:59"'}}if(n==0||n==5||n==6||n==7){return'"'+t+'"'}else{return t}}e.extend(e.fn.datagrid.defaults.editors,{EditorsForSearchQuery_FBrakcet:{init:function(a,t){var n=e('<input   type="text" class="datagrid-editable-input"/>').appendTo(a);n.outerHeight(a.parents("td[field]").height());n.numberbox({min:0,max:100,precision:0});n.focus();return n},getValue:function(a){return e(a).val()},setValue:function(a,t){e(a).val(t)},resize:function(a,t){var n=e(a);if(e.boxModel==true){n.width(t-(n.outerWidth()-n.width()))}else{n.width(t)}},destroy:function(a){e(a).numberbox("destroy")}},EditorsForSearchQuery_ABrakcet:{init:function(a,t){var n=e('<input   type="text" class="datagrid-editable-input"/>').appendTo(a);n.outerHeight(a.parents("td[field]").height());n.numberbox({min:0,max:100,precision:0});n.focus();return n},getValue:function(a){return e(a).val()},setValue:function(a,t){e(a).val(t)},resize:function(a,t){var n=e(a);if(e.boxModel==true){n.width(t-(n.outerWidth()-n.width()))}else{n.width(t)}},destroy:function(a){e(a).numberbox("destroy")}},EditorsForSearchQuery_ObjCon:{init:function(a,t){var n=a.parents("div.objcondition_Me")[0];var o=e.data(n,"objcondition").options;var i=o.tbSearchQuery.datagrid("getSelected");var r=e('<input type="text" />').appendTo(a);r.combobox({height:a.parents("td[field]").height(),editable:false,valueField:"Value",textField:"Text",data:i.ObjCons,onSelect:function(e){var a=o.tbSearchQuery.datagrid("getSelected");if(a==null){return}if(e.Text=="日期范围"){a.IsDoubleValue=false;a.ConValueSecond="";a.oldRefStyle=a.iRefStyle;a.iRefStyle=3;a.ItemSource=[{Value:"TDay",Text:"本日"},{Value:"TWeek",Text:"本周"},{Value:"TMonth",Text:"本月"},{Value:"TYear",Text:"本年"},{Value:"PDay",Text:"昨日"},{Value:"PWeek",Text:"上周"},{Value:"PMonth",Text:"上月"},{Value:"PYear",Text:"上年"}]}else{if(e.Text=="介于"){a.IsDoubleValue=true}else{a.IsDoubleValue=false;a.ConValueSecond=""}if(a.oldRefStyle!=null)a.iRefStyle=a.oldRefStyle}}});r.focus();return r},getValue:function(a){return e(a).combobox("getValue")},setValue:function(a,t){e(a).combobox("setValue",t)},resize:function(a,t){e(a).combobox("resize",t)},destroy:function(a){e(a).combobox("destroy")}},EditorsForSearchQuery_ConLogic:{init:function(a,t){var n=a.parents("div.objcondition_Me")[0];var o=e.data(n,"objcondition").options;var i=o.tbSearchQuery.datagrid("getSelected");var r=e('<input type="text"/>').appendTo(a);r.combobox({editable:false,valueField:"Value",textField:"Text",data:i.ConLogics,height:a.parents("td[field]").height()});r.focus();return r},getValue:function(a){return e(a).combobox("getValue")},setValue:function(a,t){e(a).combobox("setValue",t)},resize:function(a,t){e(a).combobox("resize",t)},destroy:function(a){e(a).combobox("destroy")}},EditorsForSearchQuery_ConValue:{init:function(a,t){var n=a.parents("div.objcondition_Me")[0];var o=e.data(n,"objcondition").options;var i=o.tbSearchQuery.datagrid("getSelected");var r='<input   type="text" iRefStyle="'+i.iRefStyle+'" />';var l;switch(i.iRefStyle){case 0:l=e(r).outerHeight(a.parents("td[field]").height()).appendTo(a);break;case 1:r='<input type="checkbox">';l=e(r).appendTo(a);break;case 2:l=e(r).appendTo(a);var d={editable:true,valueField:"Value",textField:"Text",data:i.ItemSource,height:a.parents("td[field]").outerHeight()};if(i.combobox_param){e.extend(d,i.combobox_param)}l.ex_combobox(d);break;case 3:l=e(r).appendTo(a);var d={editable:false,valueField:"Value",textField:"Text",data:i.ItemSource,height:a.parents("td[field]").outerHeight()};if(i.combobox_param){e.extend(d,i.combobox_param)}l.ex_combobox(d);break;case 4:l=e(r).appendTo(a);l.mxdate({height:a.parents("td[field]").height()});break;case 5:l=e(r).appendTo(a);l.mxdate({height:a.parents("td[field]").height(),type:"time"});break;case 6:var c=a.parents("td[field]").height();l=e(r).appendTo(a);var d={inittag:i.cFieldName,initui:i.append.reftext_initui,height:c};if(i.reftext_param){e.extend(d,i.reftext_param)}l.reftext(d);var d=l.reftext("options");i.append.textpath=d.textpath;i.append.valuepath=d.valuepath;break;case 7:l=e(r).appendTo(a);i.append={};l.ex_combotree({editable:false,data:i.ItemSource,showsearch:true,height:a.parents("td[field]").outerHeight()});break;case 41:l=e(r).appendTo(a);l.mxdate({height:a.parents("td[field]").height(),type:"month"});break;default:break}l.focus();return l},getValue:function(a){var t=e(a).parents("div.objcondition_Me")[0];var n=e.data(t,"objcondition").options;var o=n.tbSearchQuery.datagrid("getSelected");switch(o.iRefStyle){case 0:return e(a).val();break;case 1:return e(a).prop("checked");break;case 2:return e(a).combobox("getValue");break;case 3:return e(a).combobox("getValue");break;case 4:return e(a).mxdate("getValue");break;case 5:return e(a).mxdate("getValue");break;case 6:if(n.ForSearc_currentField=="ConValue"){o.append.item=e(a).reftext("GetItem")}else{o.append.item2=e(a).reftext("GetItem")};return e(a).reftext("GetValue");break;case 7:var i={id:e(a).combotree("getValue"),text:e(a).combotree("getText")};if(n.ForSearc_currentField=="ConValue"){o.append.item=i}else{o.appendTo.item2=i}return i.id;break;case 41:return e(a).mxdate("getValue");break;default:break}},setValue:function(a,t){var n=e(a).parents("div.objcondition_Me")[0];var o=e.data(n,"objcondition").options;var i=o.tbSearchQuery.datagrid("getSelected");if(i.iRefStyle==4){var r=/^[0-9]{4}-[0-1]?[0-9]{1}-[0-3]?[0-9]{1}$/;if(!r.test(t))t=""}if(i.iRefStyle==5){var r=/^[0-9]{4}-[0-1]?[0-9]{1}-[0-3]?[0-9]{1} [0-2]?[0-9]{1}:[0-5]?[0-9]{1}:[0-5]?[0-9]{1}$/;if(!r.test(t))t=""}if(i.iRefStyle==2||i.iRefStyle==3){var r=/^[0-9]{4}-[0-1]?[0-9]{1}-[0-3]?[0-9]{1}$/;if(r.test(t))t=""}if(i.iRefStyle==41&&t!=""&&t!=null){t=t+"-01"}switch(i.iRefStyle){case 0:e(a).val(t);break;case 1:e(a).prop("checked",t==true||t=="true"?true:false);break;case 2:e(a).combobox("setValue",t);break;case 3:e(a).combobox("setValue",t);break;case 4:e(a).mxdate("setValue",t);break;case 5:e(a).mxdate("setValue",t);break;case 6:e(a).reftext("SetItem",o.ForSearc_currentField=="ConValue"?i.append.item:i.append.item2);break;case 7:e(a).combotree("setValue",t);break;case 41:e(a).mxdate("setValue",t);break;default:break}},resize:function(a,t){var n=e(a).parents("div.objcondition_Me")[0];var o=e.data(n,"objcondition").options;var i=o.tbSearchQuery.datagrid("getSelected");switch(i.iRefStyle){case 0:V(a,t);break;case 1:break;case 2:e(a).combobox("resize",t);break;case 3:e(a).combobox("resize",t);break;case 4:e(a).mxdate("resize",{width:t,height:a.parents("td[field]").height()});break;case 5:e(a).mxdate("resize",{width:t,height:a.parents("td[field]").height()});break;case 6:e(a).reftext("resize",{width:t,height:a.parents("td[field]").height()});break;case 7:e(a).combotree("resize",t);break;case 41:e(a).mxdate("resize",{width:t,height:a.parents("td[field]").height()});break;default:break}},destroy:function(a){var t=e(a).parents("div.objcondition_Me")[0];var n=e.data(t,"objcondition").options;var o=n.tbSearchQuery.datagrid("getSelected");switch(o.iRefStyle){case 0:break;case 1:break;case 2:e(a).combobox("destroy");break;case 3:e(a).combobox("destroy");break;case 4:e(a).mxdate("destroy");break;case 5:e(a).mxdate("destroy");break;case 6:e(a).reftext("destroy");break;case 7:e(a).combotree("destroy");break;case 41:e(a).mxdate("destroy");break;default:break}}}});function V(a,t){var n=e(a);n.outerWidth(t)}function j(a){var t=e.data(a,"objcondition").options;var n=t.divConfig.find("select");var o=[];n.find(">option").each(function(){o.push({AutoID:e(this).val(),isShow:e(this).attr("selected")=="selected"?false:true})});e.ajax({url:"/SysBase/ObjConditionForSearch/SaveConfigData",type:"POST",data:{objid:t.objid,configrows:jsonToString(o)},dataType:"json",success:function(a){if(e.type(a)=="string"){if(a=="success"){t.tbSearchQuery.datagrid("load",{objid:t.objid});return}if(!a.startsWith("{")){e.messager.alert("数据更改",a,"warning");exSaveError();return}}}})}})(jQuery);(function(r){r.fn.formvalidate=function(t,f){if(typeof t=="string"){var s=r.fn.formvalidate.methods[t];if(s){return s(this,f)}}t=t||{};return this.each(function(){var f=r.data(this,"formvalidate");if(f){r.extend(f.options,t)}else{f=r.data(this,"formvalidate",{options:r.extend({},r.fn.formvalidate.defaults,t)})}e(f.options.displayNames);a(this);i(this);n(this);o(this)})};r.fn.formvalidate.defaults={displayNames:[],errors:[],isValiting:false,isErrorShow:false,onValidate:function(){}};r.fn.formvalidate.defDisplay={cField:"",cShowName:"",needColon:true,isRequired:false,autoValit:false,requiredInfo:"",autoValitInfo:"",autoCode:false};r.fn.formvalidate.methods={validateItem:function(e){var a=r.data(e[0],"formvalidate").options;a.isValiting=true;return d(e[0])},addError:function(r,e){s(r[0],e)},clear:function(r){u(r[0])}};var e=function(e){r.each(e,function(a,t){e[a]=r.extend({},r.fn.formvalidate.defDisplay,t)})};var a=function(e){var a=r.data(e,"formvalidate").options;if(a.errorCard==null){var t=r('<div  class="errorCard"><ul ></ul></div>').appendTo("body");var i=r('<div class="errorTag"><span></span> 条提示信息</div>').appendTo("body");a.errorCard=t;a.errorTag=i;a.errorTag.bind("click",function(){l(e)});r(document).unbind(".formvalidate").bind("mousedown.formvalidate",function(t){if(a.isErrorShow){if(r(t.target).closest(".errorCard").length){}else{c(e)}}})}};var t=function(e){var a=r.data(e,"formvalidate").options;r.each(a.displayNames,function(a,t){var i=r(e).find('[name="'+t.cField+'_Title"]');if(i.length>0){var n=t.cShowName+(t.needColon?":":"");i.html(n)}})};var i=function(e){var a=r.data(e,"formvalidate").options;r.each(r.grep(a.displayNames,function(r,e){return r.isRequired==true}),function(a,t){var i=r(e).find('label[for="'+t.cField+'"]');i.addClass("requiredTag")})};var n=function(e){var a=r.data(e,"formvalidate").options;r.each(r.grep(a.displayNames,function(r,e){return r.autoCode==true}),function(a,t){var i=r(e).find('[name="'+t.cField+'_Title"]');i.addClass("autoCodeTag");var n=r(e).find('[name="'+t.cField+'"]');n.val("自动编码");n.attr("settag","adddis,editdis");n.addClass("autoCodeTag")})};var o=function(e){var a=r.data(e,"formvalidate").options;r.each(r.grep(a.displayNames,function(r,e){return r.autoValit==true}),function(a,t){var i=r(e).find('[comboname="'+t.cField+'"]');if(i.is(".easyui-combobox,.easyui-datebox")){i.combo({onChange:function(){d(e)}});return}if(i.is(".reftext-f")){i.reftext({OnSelectItem:function(){d(e)}})}i.bind("change",function(){d(e)})})};var f=function(e){var a=r.data(e,"formvalidate").options;r.each(r.grep(a.displayNames,function(r,e){return r.isRequired==true}),function(r,a){var t=p(e,a.cField);var i=x(t);if(i===null||i===""||i==="undefined"||i==="00000000-0000-0000-0000-000000000000"){var n=a.requiredInfo;if(n==""||n==null||n=="undefined"){var o=a.cShowName;n=o+" 为必填项，不允许为空！"}s(e,{info:n,dom:t})}})};var s=function(e,a){var t=r.data(e,"formvalidate").options;a["index"]=t.errors.length;b(a.dom);t.errors.push(a);var i=r("<li></li>").appendTo(t.errorCard.find("ul"));var n=r('<a style="cursor:pointer" index='+a.index+">"+a.info+"</a>").appendTo(i);n.bind("click",function(){v(e,r(this))});n.bind("mouseover",function(){m(e,r(this))})};var d=function(e){var a=r.data(e,"formvalidate").options;if(!a.isValiting){return}u(e);f(e);a.onValidate.call(e);if(a.errors.length<=0){a.errorTag.css({display:"none"});return true}else{a.errorTag.find("span").html(a.errors.length);l(e);return false}};var u=function(e){var a=r.data(e,"formvalidate").options;r(e).find("*").removeClass("errorUI");a.errors=[];a.errorCard.find("ul").empty();a.errorTag.css({display:"none"})};var l=function(e){var a=r.data(e,"formvalidate").options;if(a.errors.length<=0){return}if(a.isErrorShow){return}a.errorTag.css({display:"none"});var t=a.errorCard;t.css({bottom:t.height()*-1,display:"block"});t.animate({bottom:0},1e3,function(){a.isErrorShow=true})};var c=function(e){var a=r.data(e,"formvalidate").options;r(e).find(".errorUI").removeClass("select");var t=a.errorCard;t.animate({bottom:t.height()*-1},1e3,function(){a.isErrorShow=false;t.css({display:"none"});if(a.errors.length>0){a.errorTag.css({display:"block"})}})};var m=function(e,a){var t=r.data(e,"formvalidate").options;var i=a.attr("index");if(i==null||i=="undefined"){return}var n=t.errors[i];g(n.dom)};var v=function(e,a){var t=r.data(e,"formvalidate").options;var i=a.attr("index");if(i==null||i=="undefined"){return}var n=t.errors[i];h(n.dom);c(e)};var p=function(e,a){var t=r(e).find('[comboname="'+a+'"]');if(t.length>0){return t}t=r(e).find('[reftextname="'+a+'"]');if(t.length>0){return t}return r(e).find('[name="'+a+'"]')};var x=function(r){if(r.length<=0){return""}if(r.is(".easyui-combobox")){return r.combobox("getText")}if(r.is(".combo-f")){return r.combo("getText")}if(r.is(".reftext-f")){return r.reftext("GetValue")}if(r.is(".mxdate-f")){return r.val()}if(r.is(".mxcalc-f")){return r.mxcalc("getValue")}if(r.is("input[type='text']")){return r.val()}if(r.is("input[type='password']")){return r.val()}if(r.is("select")){return r.val()}};var h=function(r){if(r.is(".easyui-combobox")){return r.combobox("textbox").focus()}if(r.is(".combo-f")){return r.combo("textbox").focus();return r.next("span").find("input:text:eq(0)").focus()}if(r.is(".reftext-f")){return r.reftext("focus")}if(r.is(".mxdate-f")){return r.mxdate("focus")}if(r.is(".mxcalc-f")){return r.mxcalc("focus")}r.focus()};var b=function(r){if(r.is(".combo-f,.reftext-f,.mxdate-f,.mxcalc-f")){return r.next("span").find("input:text:eq(0)").addClass("errorUI")}r.addClass("errorUI")};var g=function(e){r("form .errorUI").removeClass("select");if(e.is(".combo-f,.reftext-f,.mxdate-f,.mxcalc-f")){return e.next("span").find("input:text:eq(0)").addClass("select")}e.addClass("select")};var y=function(r){if(r.is(".easyui-combobox,.easyui-datebox")){return r.attr("comboname")}if(r.is(".reftext-f")){return r.attr("reftextname")}if(r.is(".mxdate-f")){return r.attr("name")}if(r.is(".mxcalc-f")){return r.attr("mxcalcname")}return r.attr("name")}})(jQuery);(function(t){t.fn.tableconfig=function(e,a){if(typeof e=="string"){var i=t.fn.tableconfig.methods[e];if(i){return i(this,a)}}e=e||{};return this.each(function(){var a=t.data(this,"tableconfig");if(a){t.extend(a.options,e)}else{a=t.data(this,"tableconfig",{options:t.extend({},t.fn.tableconfig.defaults,e)})}u(this)})};t.fn.tableconfig.defaults={pageName:"",getUrl:"/SysBase/DataGridConfig/GetShowColumns",saveUrl:"/SysBase/DataGridConfig/SaveDataGridConfig",resetUrl:"/SysBase/DataGridConfig/ResetConfig",tables:[],onBeginGetData:function(){},onEndGetData:function(t){},onSaveSucess:function(){},onSetColumns:function(t,e,a){}};t.fn.tableconfig.methods={beginGetData:function(t){e(t[0])},getColumns:function(t,e){return a(t[0],e)},showConfig:function(t,e){o(t[0],e)}};var e=function(e){var a=t.data(e,"tableconfig");var n=a.options;n.onBeginGetData.call(e);t.ajax({type:"POST",url:n.getUrl,data:{PageName:n.pageName},dataType:"json",success:function(o){if(t.type(o)=="string"){n.onEndGetData.call(e,o);return}t.each(o,function(e,a){a["GCID"]="";t.each(a.bodys,function(e,i){a.GCID=i.GCID;var n=StringToJson(i.showInfo),o=n.title;i.showInfo=t.extend({},n,StringToJson(i.configInfo));i.showInfo.systitle=o})});a["tableDisplays"]=o;i(e);n.onEndGetData.call(e,"")}})};var a=function(e,a){var i=t.data(e,"tableconfig");var o=i.options;var r=t.grep(i.tableDisplays,function(t,e){return t.Tag===a});if(r.length<=0){return[]}var l=[];var s=[];var d=t.browser.useapp?true:false;if(d){l=[[]];s=n(t.grep(r[0].bodys,function(t,e){return t.isShow==true}))}else{l=n(t.grep(r[0].bodys,function(t,e){return t.isFix==true&&t.isShow==true}));s=n(t.grep(r[0].bodys,function(t,e){return t.isFix==false&&t.isShow==true}))}t.each(s,function(i,n){t.each(n,function(t,i){o.onSetColumns.call(e,a,false,i)})});t.each(l,function(i,n){t.each(n,function(t,i){o.onSetColumns.call(e,a,true,i)})});ReCorventColumnFormatter(l);ReCorventColumnFormatter(s);if(l.length==0){l=null}if(s.length==0){s=null}return{frozenColumns:l,columns:s}};var i=function(e){var i=t.data(e,"tableconfig");var n=i.options;if(n.tables.length<=0){return}t.each(n.tables,function(t,i){var n=a(e,i.tag);i.table.datagrid(n)})};var n=function(e){var a=[];t.each(e,function(t,e){var i=a.length-1;if(e.GroupIndex>i){for(var t=i;t<e.GroupIndex-1;t++){a.push([])}}a[e.GroupIndex-1].push(e.showInfo)});return a};var o=function(e,a){var i=t.data(e,"tableconfig");if(!i["isSetConfig"]){l(e);s(e);i.configDialog.removeClass("hidden");i.configDialog.bs_dialog({width:"lg",title:'<h5 style="margin-top:5px;margin-bottom:5px;"><i class="ace-icon fa fa-cog orange fa-2x" style="margin-right:5px;"></i>列配置</h5>',buttons:[{dom:'<button class="btn btn-sm btn-warning pull-left"><i class="ace-icon fa  fa-reply-all "></i><span class="">重置</span></button>',handler:function(){var e=i.tc_tables.val();var a=i.tc_tables.find('option[value="'+e+'"]').html();if(!a)a="";else a="["+a+"]";var n=t.grep(i.tableDisplays,function(t,a){return t.Tag===e});if(n.length<=0){return}var o=n[0].GCID;t.messager.confirm("确认","确认重置列配置"+a+"？",function(e){if(e){i.configDialog.bs_dialog("showLoading");t.ajax({type:"POST",url:i.options.resetUrl,data:{GCID:o},success:function(e){i.configDialog.bs_dialog("hideLoading");if(e.error){t.messager.alert("",e.error,"");return}if(e!=""){t.messager.alert("",e.error,"");return}i.configDialog.bs_dialog("close");t.messager.confirm("操作提示","表格配置"+a+"已经重置,是否刷新重置当前页!",function(t){if(!t){return}location.reload(true)})}})}})}},{dom:'<span btnName="isTableGX" class="'+(ac.isAdmin?" ":"hidden")+'">            <label>                <model class="muted">共享配置</model>                <input class="ace ace-switch ace-switch-5 " name="isTableGX"  type="checkbox" >                <span class="lbl middle"></span>            </label>        </span>',handler:function(){}},{dom:'<button class="btn btn-sm btn-primary mx-xs-quick"><i class="ace-icon fa fa-save"></i><span class="">保存</span></button>',handler:function(){b(e)}}],onShow:function(){if("undefined"!=typeof currentShow&&"undefined"!=typeof bodyTableTag){if(!!a){i.tc_tables.val(a)}else{if(currentShow=="right"){i.tc_tables.val(bodyTableTag)}else{i.tc_tables.val(tableTag)}}d(e)}i.tc_sourceColumns.datagrid("resize");i.tc_configGrid.datagrid("resize");i.tc_destColumns.datagrid("resize")}});i["isSetConfig"]=true}i.configDialog.bs_dialog("open");r(e);d(e)};var r=function(e){var a=t.data(e,"tableconfig");a.tc_tables.empty();a.tc_tables.bind("change",function(){d(e)});t.each(a.tableDisplays,function(t,e){a.tc_tables.append('<option value="'+e.Tag+'">'+e.TagName+"</option>")})};var l=function(e){var a=t.data(e,"tableconfig");a.tc_sourceColumns.datagrid({singleSelect:true,fit:true,showHeader:false,fitColumns:true,columns:[[{title:"显示列名",field:"title",width:200}]]});a.tc_destColumns.datagrid({singleSelect:true,fit:true,showHeader:false,fitColumns:true,columns:[[{title:"显示列名",field:"title",width:200}]],onSelect:function(t,a){if(a==null||a==undefined){return}var i=g(e,a.id);if(i!=null){c(e,i)}}})};var s=function(e){var a=t.data(e,"tableconfig");a.tc_configGrid.propertygrid({fit:true,columns:[[{title:"列属性",field:"name",width:100},{title:"属性值",field:"value",width:100,formatter:function(t,e,a){if(e.tag==="align"){switch(t){case"left":return"左对齐";break;case"center":return"居中对齐";break;case"right":return"右对齐";break;default:return t;break}}return t}}]],onAfterEdit:function(i,n,o){if(!o["value"]){return}var r=a.tc_currentConfigID.val();if(r==null||r==undefined||r==""){return}var l=g(e,r);if(l!=null){l.showInfo[n.tag]=o["value"];if(n.tag=="title"){var s=a.tc_destColumns;t.each(t.grep(s.datagrid("getRows"),function(t,e){return t.id==r}),function(t,e){var a=s.datagrid("getRowIndex",e);e.title=l.showInfo.title;s.datagrid("refreshRow",a)})}}}})};var d=function(e){var a=t.data(e,"tableconfig");var i=a.tc_tables.val();var n=t.grep(a.tableDisplays,function(t,e){return t.Tag===i});if(n.length<=0){return}t('input[name="isTableGX"]').prop("checked",n[0].isGX);a.tc_sourceColumns.datagrid("loadData",t.map(t.grep(n[0].bodys,function(t,e){return t.isShow==false}),function(t){return{id:t.GCBodyID,title:t.showInfo.title}}));a.tc_destColumns.datagrid("loadData",t.map(t.grep(n[0].bodys,function(t,e){return t.isShow==true}),function(t){return{id:t.GCBodyID,title:t.showInfo.title}}));a.tc_sourceColumns.datagrid("selectRow",0);a.tc_destColumns.datagrid("selectRow",0)};var c=function(e,a){var i=t.data(e,"tableconfig");var n=i.tc_configGrid;var o=n.datagrid("getSelected");var r=-1;if(!(o==null||o==undefined)){var l=n.datagrid("getRowIndex",o);r=l;n.datagrid("endEdit",l)}n.datagrid("loadData",[{name:"默认名称",tag:"systitle"},{name:"显示名称",tag:"title",editor:"text"},{name:"宽度",tag:"width",editor:"text"},{name:"显示方向",tag:"align",editor:{type:"combobox",options:{editable:false,valueField:"value",textField:"text",data:[{value:"left",text:"左对齐"},{value:"center",text:"居中对齐"},{value:"right",text:"右对齐"}]}}}]);t.each(n.datagrid("getRows"),function(t,e){e.value=a.showInfo[e.tag];n.datagrid("refreshRow",t)});i.tc_currentConfigID.val(a.GCBodyID);if(r!=-1){}};var g=function(e,a){var i=t.data(e,"tableconfig");var n=t.grep(i.tableDisplays,function(t,e){return t.Tag===i.tc_tables.val()});if(n.length<=0){return null}var o=t.grep(n[0].bodys,function(t,e){return t.GCBodyID==a});if(o.length<=0){return null}return o[0]};var u=function(e){var a=t.data(e,"tableconfig");if(a["isSetUI"]){return}a["configDialog"]=t('<div class="row form-horizontal hidden"></div>').appendTo(t("body"));var i=t('<div class="form-group col-sm-12" ><label class="control-label no-padding-right col-xs-12 col-sm-6 col-md-4 col-lg-4"> 选择需要配置的表格</label><div class="col-xs-12 col-sm-6 col-md-8 col-lg-8"></div></div>').appendTo(a["configDialog"]);a["tc_tables"]=t('<select id="tc_tables" class="width-100"></select>').appendTo(i.find(">div"));var n=t('<div class="col-sm-12"><div class="col-xs-6 col-sm-3 col-md-3 col-lg-3"></div><div class="col-xs-6 col-sm-3 col-md-3 col-lg-3"></div><div class="col-xs-12 col-sm-6 col-md-6 col-lg-6"></div></div>').appendTo(a.configDialog);var o=t('<div class="widget-box widget-color-grey"><div class="widget-header"><h4 class="widget-title lighter smaller">隐藏列</h4><div class="widget-toolbar no-border"><a href="#" data-tag="moveright" >	<i class="ace-icon fa fa-chevron-right bigger-125 orange2 tooltip-info" title="添加列" data-rel="tooltip" data-placement="bottom" ></i></a></div></div><div class="widget-body" style="height:180px;"></div></div>').appendTo(n.children("div:eq(0)"));a["tc_sourceColumns"]=t("<div></div>").appendTo(o.find("div.widget-body"));var r=t('<div class="widget-box widget-color-grey"><div class="widget-header"><a href="#"  style="margin-right:20px;"  data-tag="moveleft" >	<i class="ace-icon fa fa-chevron-left bigger-125  orange2 tooltip-info" title="移除列" data-rel="tooltip" data-placement="bottom" ></i></a><h4 class="widget-title lighter smaller">显示列</h4><div class="widget-toolbar no-border"><a href="#"  style="margin-right:5px;"  data-tag="moveup" >	<i class="ace-icon fa fa-chevron-up bigger-125 orange2 tooltip-info" title="上移" data-rel="tooltip" data-placement="bottom"></i></a><a href="#"  data-tag="movedown" >	<i class="ace-icon fa fa-chevron-down bigger-125 orange2 tooltip-info" title="下移" data-rel="tooltip" data-placement="bottom"></i></a></div></div><div class="widget-body" style="height:180px;"></div></div>').appendTo(n.children("div:eq(1)"));a["tc_destColumns"]=t("<div></div>").appendTo(r.find("div.widget-body"));var l=t('<div class="widget-box widget-color-grey"><div class="widget-header"><h4 class="widget-title lighter smaller">列属性</h4></div><div class="widget-body" style="height:180px;"></div></div>').appendTo(n.children("div:eq(2)"));t("[data-rel=tooltip]").tooltip();a["tc_configGrid"]=t("<div></div>").appendTo(l.find("div.widget-body"));a["tc_currentConfigID"]=t('<input  type="hidden" />').appendTo(n.children("div:eq(2)"));n.find("div.widget-box>div.widget-header a[data-tag]").on("mouseover",function(){}).on("mouseout",function(){}).on("click",function(){var a=t(this).data("tag");switch(a){case"moveright":v(e);break;case"moveleft":f(e);break;case"moveup":m(e);break;case"movedown":h(e);break;default:}});a["isSetUI"]=true};var f=function(e){var a=t.data(e,"tableconfig");var i=a.tc_destColumns.datagrid("getSelected");if(i==null){return}var n=g(e,i.id);if(!n.isCanConfig){t.messager.alert("","此列不允许移除显示！");return}if(n.GroupIndex>1){t.messager.alert("","此列不允许移除显示！");return}var o=a.tc_destColumns.datagrid("getRowIndex",i);a.tc_destColumns.datagrid("deleteRow",o);var r=a.tc_destColumns.datagrid("getRows").length;a.tc_destColumns.datagrid("selectRow",o>=r?r-1:o);a.tc_sourceColumns.datagrid("appendRow",i);a.tc_sourceColumns.datagrid("selectRow",a.tc_sourceColumns.datagrid("getRows").length-1);if(n!=null){n.isShow=false}};var v=function(e){var a=t.data(e,"tableconfig");var i=a.tc_sourceColumns.datagrid("getSelected");if(i==null){return}var n=g(e,i.id);var o=a.tc_sourceColumns.datagrid("getRowIndex",i);a.tc_sourceColumns.datagrid("deleteRow",o);var r=a.tc_sourceColumns.datagrid("getRows").length;a.tc_sourceColumns.datagrid("selectRow",o>=r?r-1:o);a.tc_destColumns.datagrid("appendRow",i);a.tc_destColumns.datagrid("selectRow",a.tc_destColumns.datagrid("getRows").length-1);if(n!=null){n.isShow=true}};var m=function(e){var a=t.data(e,"tableconfig");var i=a.tc_destColumns.datagrid("getSelected");if(i==null){return}var n=g(e,i.id);if(n.GroupIndex>1){t.messager.alert("","此列不允许改变顺序！");return}var o=a.tc_destColumns.datagrid("getRowIndex",i);if(o==0){return}a.tc_destColumns.datagrid("deleteRow",o);a.tc_destColumns.datagrid("insertRow",{index:o-1,row:i});a.tc_destColumns.datagrid("selectRow",o-1)};var h=function(e){var a=t.data(e,"tableconfig");var i=a.tc_destColumns.datagrid("getSelected");if(i==null){return}var n=g(e,i.id);if(n.GroupIndex>1){t.messager.alert("","此列不允许改变顺序！");return}var o=a.tc_destColumns.datagrid("getRowIndex",i);var r=a.tc_destColumns.datagrid("getRows").length;if(o==r-1){return}a.tc_destColumns.datagrid("deleteRow",o);a.tc_destColumns.datagrid("insertRow",{index:o+1,row:i});a.tc_destColumns.datagrid("selectRow",o+1)};var p=function(e){var a=t.data(e,"tableconfig");var i=t.grep(a.tableDisplays,function(t,e){return t.Tag===a.tc_tables.val()});if(i.length<=0){return}var n=[];t.each(a.tc_destColumns.datagrid("getRows"),function(t,a){var i=g(e,a.id);if(i==null){return true}i.iOrder=t+1;n.push(i)});t.each(a.tc_sourceColumns.datagrid("getRows"),function(t,a){var i=g(e,a.id);if(i==null){return true}i.iOrder=t+1;n.push(i)});i[0].bodys=n};var b=function(e){var a=t.data(e,"tableconfig");var n=a.options;p(e);i(e);var o=[];var r=null;var l=a.tc_tables.val();t.each(a.tableDisplays,function(e,a){if(a.Tag==l){r=a}t.merge(o,t.map(a.bodys,function(t){var e=t.showInfo;var a={align:e.align,colspan:e.colspan,field:e.field,halign:e.halign,rowspan:e.rowspan,title:e.title,width:e.width,formatter:e.formatter};return{GCID:t.GCID,GCBodyID:t.GCBodyID,isShow:t.isShow,iOrder:t.iOrder,isFix:t.isFix,configInfo:jsonToString(a)}}))});var s=t('input[name="isTableGX"]').prop("checked");var d=function(){t.ajax({type:"POST",url:n.saveUrl,data:{PageName:n.pageName,bodys:jsonToString(o),isGX:s},success:function(i){if(i==""){r.isGX=ac.isAdmin?s:false;a.configDialog.bs_dialog("close");n.onSaveSucess.call(e)}else{t.messager.alert("保存数据",i,"")}}})};if(!ac.isAdmin&&r.isGX){t.messager.confirm("数据保存","管理员已经共享配置,是否自定义配置?",function(t){if(t){d()}})}else{d()}}})(jQuery);(function($){$.fn.mxcalc=function(a,t){if(typeof a=="string"){var l=$.fn.mxcalc.methods[a];if(l){return l(this,t)}}a=a||{};return this.each(function(){var t=$.data(this,"mxcalc");if(t){$.extend(t.options,a)}else{t=$.data(this,"mxcalc",{options:$.extend({},$.fn.mxcalc.defaults,a)});showui(this)}t["num1"]=null;t["num0"]=null;t["symble"]=null;t["lastclick"]=null;t["symarr"]=["+","－","×","÷","="];t["showup"]="";setui(this)})};$.fn.mxcalc.defaults={width:120,height:20,prefix:"",suffix:"",min:null,max:null,precision:-1,DefValue:"0",isShowCalc:true,isUseTable:false,onUseTableClick:function(a){},onSuccess:function(a){},onError:function(a){},onChange:function(a){}};$.fn.mxcalc.methods={setValue:function(a,t){var l=$.data(a[0],"mxcalc");l.txtshow.val(t);formatValue(a[0])},getValue:function(a){var t=$.data(a[0],"mxcalc");if(t.txtshow.is(":focus")){formatValue(a[0])}return t.txtvalue.val()},focus:function(a){$.data(a[0],"mxcalc").txtshow.focus()},options:function(a){return $.data(a[0],"mxcalc").options},resize:function(a,t){a.each(function(a,l){var e=$.data(this,"mxcalc").options;e.width=t.width;e.height=t.height;sizeui(this,false);sizeHeight(this)})},destroy:function(a){a.each(function(a,t){var l=$.data(this,"mxcalc");l.mxcalc.remove();if(l.isDrawBox){l.box.remove()}$(this).remove()})},hideBox:function(a){a.each(function(){hideBox(this)})},textbox:function(a){return $.data(a[0],"mxcalc").txtshow},disable:function(a){a.each(function(){setdisabled(this,true)})},enable:function(a){a.each(function(){setdisabled(this,false)})}};var showui=function(a){$(a).hide();var t=$.data(a,"mxcalc");var l=$.data(a,"mxcalc").options;var e=$('<span class="input-icon input-icon-right mxcalc mx-input-group"></span>').insertAfter(a);e.addClass($(a).attr("class"));e.removeClass("form-control");var c=l.readonly?" readonly":" ";var n=$('<input type="text" class="form-control mxcalc-text"'+c+">").appendTo(e);t["txtshow"]=n;if(!l.isUseTable){if(l.isShowCalc){var i=$('<i class="ace-icon fa fa-calculator mxcalc-calc-button  bigger-120"></i>').appendTo(e);t["btnref"]=i}}else{var i=$('<i class="ace-icon fa fa-search-plus green mxcalc-calc-button  bigger-150"></i>').appendTo(e);t["btnref"]=i}var o=$('<input type="hidden" class="mxcalc-value"/>').appendTo(e);t["txtvalue"]=o;$(a).addClass("mxcalc-f");var s=$(a).attr("name");if(s){$(a).removeAttr("name");$(a).attr("mxcalcName",s);t["txtvalue"].attr("name",s)}t["mxcalc"]=e;t.txtshow.bind("blur",function(){formatValue(a);t.options.onChange(t)}).bind("focus",function(){t.txtshow.val(t.txtvalue.val());t.txtshow.select()});formatValue(a);t["isDrawBox"]=false;return e};function sizeui(a){var t=$.data(a,"mxcalc");var l=t.options;t.mxcalc.outerWidth(l.width)}function sizeHeight(a){var t=$.data(a,"mxcalc");var l=t.options;var e=t.mxcalc;e.outerHeight(l.height);t.txtshow.outerHeight(l.height);if(l.isShowCalc){t.btnref.outerHeight(l.height)}}var benter=false;function setui(a){var t=$.data(a,"mxcalc");var l=t.options;if(l.isUseTable){t.btnref.unbind(".mxcalc").bind("click.mxcalc",function(t){var e=$.data(a,"mxcalc");l.onUseTableClick.call(this,a)});return}if(!l.isShowCalc){return}t.btnref.unbind(".mxcalc").bind("click.mxcalc",function(t){var l=$.data(a,"mxcalc");if(l.options.disabled){return}if(!l.isDrawBox){showcalcbox(a)}if(l.isShowBox){hideBox(a)}else{showBox(a,{left:t.clientX,top:t.clientY,offsetLeft:t.offsetX,offsetTop:t.offsetY,width:$(t.currentTarget).width(),height:$(t.currentTarget).height()})}}).bind("mouseenter.mxcalc",function(){if(l.disabled){return}$(this).addClass("red")}).bind("mouseleave.mxcalc",function(){if(l.disabled){return}$(this).removeClass("red")})}function setdisabled(a,t){var l=$.data(a,"mxcalc");var e=l.options;var c=l.mxcalc;if(t){e.disabled=true;$(a).attr("disabled",true);l.txtshow.attr("disabled",true)}else{e.disabled=false;$(a).removeAttr("disabled");l.txtshow.removeAttr("disabled")}}var showcalcbox=function(a){var t=$.data(a,"mxcalc");var l=[[{lable:"←"},{lable:"C"},{lable:"+"},{lable:"－"}],[{lable:"7"},{lable:"8"},{lable:"9"},{lable:"×"}],[{lable:"4"},{lable:"5"},{lable:"6"},{lable:"÷"}],[{lable:"1"},{lable:"2"},{lable:"3"},{lable:"."}],[{lable:"0",colspan:2},{lable:"=",colspan:2}]];t["box"]=$('<div class="mxcalc_box mxcalc-caret dropdown-menu"></div>').appendTo($("body"));var e="";$.each(l,function(a,t){e+="<tr>";$.each(t,function(a,t){var l="width:"+(t.colspan==null?35:t.colspan*37)+"px; height:"+(t.rowspan==null?35:t.rowspan*37)+"px;";e+="<td "+""+'" align="center" rowspan="'+(t.rowspan==null?1:t.rowspan)+'" colspan="'+(t.colspan==null?1:t.colspan)+'">';e+='<div class="calc_but btn btn-white btn-purple btn-sm"  value="'+t.lable+'">'+t.lable+"</div>";e+="</td>"});e+="</tr>"});t.box.append('<table class="mxcalc_table"><tr><td colspan="4"><div class="mxcalc_show" value="0"><div class="calc_u"><lable name="calc_u"></lable></div><div class="calc_d"><lable name="calc_d">0</lable></div></div></td></tr>'+e+"</table>");t["isShowBox"]=false;$(document).unbind("mousedown.calc").bind("mousedown.calc",function(a){setAutoHide(a)}).unbind("keydown.calc").bind("keydown.calc",function(a){setKeydown(a)});$(t.box).find(".calc_but").click(function(){calc_butClick(a,$(this).attr("value"))});t.isDrawBox=true};var formatValue=function(a){var t=$.data(a,"mxcalc");var l=t.options;var e=t.txtshow.val();if(e==""){e=l.DefValue;t.txtvalue.val(e)}e=parseFloat(e);e=e.toString();if(!$.isNumeric(e)){e=t.txtvalue.val()}if(l.min!=null){if(e<l.min){e=t.txtvalue.val()}}if(l.max!=null){if(e>l.max){e=t.txtvalue.val()}}t.txtvalue.val(e);if(l.precision<0){e=e}else{e=parseFloat(e).toFixed(l.precision)}e=l.prefix+e+l.suffix;t.txtshow.val(e)};function Initmxcalc(a){var t=$.data(a,"mxcalc");var l=t.options;if($(a).attr("readonly")=="readonly"){return}$(a).blur();if(t.box!=null){$(t.box).show();mxcalc_orien(a,t.box);return}mxcalc_orien(a,t.box)}var setAutoHide=function(a){var t=$(a.target).closest(".mxcalc_box");if(t.length>0){return}if($(".mxcalc-f").length>0){$(".mxcalc-f").mxcalc("hideBox")}};var setKeydown=function(a){if($(".mxcalc-f").length<=0){return}var t=null;$(".mxcalc-f").each(function(){var a=$.data(this,"mxcalc");if(a.isShowBox){t=this;return-1}});if(t==null){return}switch(a.keyCode){case 8:calc_butClick(t,"←");break;case 13:case 37:case 38:case 39:case 40:calc_butClick(t,"=");break;default:calc_butClick(t,a.char);break}};function showBox(a,t){var l=$.data(a,"mxcalc");var e=l.options;var c=t.left-(l.txtshow.width()+t.offsetLeft)-9;if(c<0){c=0}var n=t.top-t.offsetTop+t.height+$(window).scrollTop();if(n+l.box.height()>$(window).height()){n=t.top-t.offsetTop-l.box.height()-t.height+$(window).scrollTop();l.box.addClass("offsetbottom");l.box.removeClass("offsettop")}else{l.box.removeClass("offsetbottom");l.box.addClass("offsettop")}l.box.css({left:c,top:n,display:"block"});l.isShowBox=true}var hideBox=function(a){var t=$.data(a,"mxcalc");if(t.isDrawBox){t.box.css({display:"none"});t.isShowBox=false}};function calc_butClick(a,t){var l=$.data(a,"mxcalc");var e=l.options;if(!l.isShowBox){return}switch(t){case"/":calc_butClick(a,"÷");break;case"*":calc_butClick(a,"×");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case".":number(a,t);l.lastclick=t;break;case"+":case"－":case"÷":case"×":calsym(a,t);l.lastclick=t;break;case"=":equalcalc(a);l.lastclick=t;break;case"C":clearCal(a);break;case"←":backspace(a);break;default:break}}function number(a,t){var l=$.data(a,"mxcalc");var e=l.options;var c=$(l.box).find("[name='calc_d']");var n=$.inArray(l.lastclick,l.symarr);if(c.html().length>=16){return}if(n==-1){if(t=="."){if(e.precision==0||c.html().indexOf(".")!=-1){c.html(c.html())}else if(c.html().length==0){c.html("0"+t)}else{c.html(c.html()+t)}}else if(c.html().indexOf(".")!=-1){c.html(c.html()+t)}else if(c.html()==0){c.html(t)}else{c.html(parseFloat(c.html().replace(/,/g,""))*10+parseFloat(t.replace(/,/g,"")))}}else{c.html(t)}}function calsym(a,t){var l=$.data(a,"mxcalc");var e=l.options;var c=$(l.box).find("[name='calc_u']");var n=$(l.box).find("[name='calc_d']");var i=$.inArray(l.lastclick,l.symarr);if(l.num0==null&&l.symble==null){l.showup=n.html()+" "+t;calcshowup(a);l.num0=n.html()}else if(i==4){l.showup=n.html()+" "+t;calcshowup(a)}else if(l.num0!=null&&l.num1==null&&i!=-1){l.showup=l.showup.substring(0,l.showup.length-1)+" "+t;calcshowup(a)}else{l.showup=l.showup+" "+n.html()+" "+t;calcshowup(a);l.num1=n.html();var o=calculate(l.symble,l.num0,l.num1);l.num0=o;n.html(o);l.num1=null}l.symble=t}function clearCal(a){var t=$.data(a,"mxcalc");var l=t.options;$(t.box).find("[name='calc_u']").html("");$(t.box).find("[name='calc_d']").html("0");t.num0=null;t.num1=null;t.symble=null;t.lastclick=null}function equalcalc(a){var t=$.data(a,"mxcalc");var l=t.options;var e=$(t.box).find("[name='calc_u']");var c=$(t.box).find("[name='calc_d']");var n=$.inArray(t.lastclick,t.symarr);if(t.symble==null||t.lastclick=="="||t.lastclick=="C"||n!=-1){calc_float(a,c.html());l.onSuccess.call(a,t.txtvalue.val());hideBox(a);return}else{var i=calculate(t.symble,t.num0,c.html());t.num0=i}e.html("");t.showup="";t.num0=null;t.num1=null;t.symble=null;c.html(i);calc_float(a,i);hideBox(a);l.onSuccess.call(a,i)}function calc_float(a,t){var l=$.data(a,"mxcalc");var e=l.options;l.txtshow.val(t);formatValue(a);l.txtshow.focus()}function backspace(a){var t=$.data(a,"mxcalc");var l=t.options;var e=$.inArray(t.lastclick,t.symarr);var c=$(t.box).find("[name='calc_d']");if(e!=-1){return}else if(c.html().length==1){c.html(0)}else{c.html(c.html().substring(0,c.html().length-1))}}function calcshowup(a){var t=$.data(a,"mxcalc");var l=t.options;var e=$(t.box).find("[name='calc_u']");if(t.showup.length>30){e.html("<<"+t.showup.substring(t.showup.length-29,t.showup.length))}else{e.html(t.showup)}}function calculate(a,t,l){var e=null;t=parseFloat(t);l=parseFloat(l);switch(a){case"+":e=t.add(l);break;case"－":e=t.subtr(l);break;case"*":case"×":e=t.mul(l);break;case"/":case"÷":if(l==0){e=0;break}e=t.div(l);break;default:break}return e}Number.prototype.add=function(a){return accAdd(this,a)};function accAdd(a,t){var l,e,c;try{l=a.toString().split(".")[1].length}catch(n){l=0}try{e=t.toString().split(".")[1].length}catch(n){e=0}c=Math.pow(10,Math.max(l,e));return(a*c+t*c)/c}Number.prototype.subtr=function(a){return accSubtr(this,a)};function accSubtr(a,t){var l,e,c,n;try{l=a.toString().split(".")[1].length}catch(i){l=0}try{e=t.toString().split(".")[1].length}catch(i){e=0}c=Math.pow(10,Math.max(l,e));n=l>=e?l:e;return((a*c-t*c)/c).toFixed(n)}Number.prototype.mul=function(a){return accMul(this,a)};function accMul(a,t){var l=0,e=a.toString(),c=t.toString();try{l+=e.split(".")[1].length}catch(n){}try{l+=c.split(".")[1].length}catch(n){}return Number(e.replace(".",""))*Number(c.replace(".",""))/Math.pow(10,l)}Number.prototype.div=function(a){return accDiv(this,a)};function accDiv(arg1,arg2){var t1=0,t2=0,r1,r2;try{t1=arg1.toString().split(".")[1].length}catch(e){}try{t2=arg2.toString().split(".")[1].length}catch(e){}with(Math){r1=Number(arg1.toString().replace(".",""));r2=Number(arg2.toString().replace(".",""));return r1/r2*pow(10,t2-t1)}}})(jQuery);(function(t){t.fn.mxdate=function(a,i){if(typeof a=="string"){var n=t.fn.mxdate.methods[a];if(n){return n(this,i)}}a=a||{};return this.each(function(){var i=t.data(this,"mxdate");if(i){t.extend(i.options,a)}else{i=t.data(this,"mxdate",{options:t.extend({},t.fn.mxdate.defaults,a)});e(this)}o(this)})};t.fn.mxdate.defaults={width:120,height:0,type:"day",onSelect:function(t){return},readonly:false};t.fn.mxdate.methods={setValue:function(e,a){var i=t.data(e[0],"mxdate");if(a==""||a==null){i.txtshow.val("");if(i.txtshow.val()==""){t(e).val("")}return}i.picker.setDate(a)},getValue:function(e){var a=t.data(e[0],"mxdate");return a.txtshow.val()},focus:function(e){t.data(e[0],"mxdate").txtshow.focus()},options:function(e){return t.data(e[0],"mxdate").options},resize:function(e,n){e.each(function(e,o){var d=t.data(this,"mxdate").options;d.width=n.width;d.height=n.height;a(this,false);i(this)})},destroy:function(e){e.each(function(e,a){var i=t.data(this,"mxdate");i.mxdate.remove();t(this).remove()})},textbox:function(e){return t.data(e[0],"mxdate").txtshow},disable:function(t){t.each(function(){d(this,true)})},enable:function(t){t.each(function(){d(this,false)})}};var e=function(e){t(e).hide();var a=t.data(e,"mxdate");var i=t.data(e,"mxdate").options;var n=t('<span class=" input-icon input-icon-right mxdate mx-input-group"></span>').insertAfter(e);n.addClass(t(e).attr("class"));n.removeClass("form-control");if(t.browser.useapp){i.readonly=true}var o=i.readonly?" readonly":" ";var d=t('<input type="text" class="form-control  mxdate-text"'+o+">").appendTo(n);a["txtshow"]=d;i.elem=a.txtshow[0];var r=t('<i class="ace-icon fa fa-calendar  bigger-120 mxdate-date-button"></i>').appendTo(n);a["btnref"]=r;t(e).addClass("mxdate-f");a["mxdate"]=n;a.txtshow.bind("keydown",function(){}).bind("blur",function(){}).bind("focus",function(){}).bind("change.mxdate",function(){if(a.txtshow.val()==""){t(e).val("")}});var s={format:false,pickDate:true,pickTime:true,autoclose:true,todayHighlight:true,useMinutes:true,useSeconds:true,minDate:moment({y:1900}),maxDate:moment().add(100,"y"),icons:{}};switch(i.type){case"day":s.format="YYYY-MM-DD";s.pickTime=false;break;case"month":s.format="YYYY-MM";s.pickTime=false;s.minViewMode=1;break;case"year":s.format="YYYY";s.pickTime=false;s.minViewMode=2;break;case"time":s.format="YYYY-MM-DD HH:mm:ss";break;case"onlytime":s.format="HH:mm:ss";s.pickDate=false;break}a.mxdate.datetimepicker(s).on("dp.change",function(n){t(e).val(n.date.format(i.format));a.options.onSelect.call(e,n.date._d)});a["picker"]=a.mxdate.data("DateTimePicker")};function a(e){var a=t.data(e,"mxdate");var i=a.options;a.mxdate.outerWidth(i.width)}function i(e){var a=t.data(e,"mxdate");var i=a.options;var n=a.mxdate;n.outerHeight(i.height);a.txtshow.outerHeight(i.height);a.btnref.outerHeight(i.height)}var n=false;function o(e){var a=t.data(e,"mxdate");var i=a.options;a.btnref.unbind(".mxdate").bind("click.mxdate",function(t){}).bind("mouseenter.mxdate",function(){if(i.disabled){return}t(this).addClass("red")}).bind("mouseleave.mxdate",function(){if(i.disabled){return}t(this).removeClass("red")})}function d(e,a){var i=t.data(e,"mxdate");var n=i.options;var o=i.mxdate;if(a){n.disabled=true;t(e).attr("disabled",true);i.txtshow.attr("disabled",true)}else{n.disabled=false;t(e).removeAttr("disabled");i.txtshow.removeAttr("disabled")}}})(jQuery);(function(e){e.fn.fullscreen=function(l,s){if(typeof l=="string"){var t=e.fn.fullscreen.methods[l];if(t){return t(this,s)}}l=l||{};return this.each(function(){var s=e.data(this,"fullscreen");if(s){e.extend(s.options,l)}else{s=e.data(this,"fullscreen",{options:e.extend({},e.fn.fullscreen.defaults,l)})}n(this)})};e.fn.fullscreen.defaults={el:null,onShow:function(){},onHide:function(){}};e.fn.fullscreen.methods={show:function(e){l(e)},hide:function(e){s(e)}};var n=function(n){var t=e.data(n,"fullscreen");var r=t.options;if(t["isSetUI"]){return}var f=e(n);if(r.el){}else{r.el=e('<button class="btn  btn-yellow btn-xs  no-border btn-fullscreen" style="position:absolute;right:0px;top:0px;"><i class="ace-icon fa fa-expand bigger-120"></i></button>').appendTo(f)}r.el.on("click",function(){if(f.hasClass("mx_fullscreen")){s(n)}else{l(n)}});t["isSetUI"]=true};var l=function(n){var l=e.data(n,"fullscreen");var s=l.options;var t=e(n);if(window.frames.length!=parent.frames.length){if(parent.fp_showFullScreen){parent.fp_showFullScreen()}}t.addClass("mx_fullscreen");t.find(".btn-fullscreen>i").addClass("fa-compress");s.onShow.call(n)};var s=function(n){var l=e.data(n,"fullscreen");var s=l.options;var t=e(n);if(window.frames.length!=parent.frames.length){if(parent.fp_hideFullScreen){parent.fp_hideFullScreen()}}t.removeClass("mx_fullscreen");t.find(".btn-fullscreen>i").removeClass("fa-compress");s.onHide.call(n)}})(jQuery);(function(a){a.fn.formconfig=function(o,t){if(typeof o=="string"){var n=a.fn.formconfig.methods[o];if(n){return n(this,t)}}o=o||{};return this.each(function(){var t=a.data(this,"formconfig");if(t){a.extend(t.options,o)}else{t=a.data(this,"formconfig",{options:a.extend({},a.fn.tableconfig.defaults,o)})}i(this)})};a.fn.formconfig.defaults={pageName:"",cols:1,onFirstDraw:function(){}};a.fn.formconfig.methods={showConfig:function(a){d(a[0])}};var i=function(i){var t=a.data(i,"formconfig");if(t["isInit"]){return}var e=t.options;var r=a(i);r.find(".fc-column").each(function(i,o){var t=a(o);var e=t.data("fc-column-title");var r=t.data("fc-column-code");t.find(">div.form-group").each(function(i,o){var t=a(o);if(t.data("fcid")&&t.data("fcid")!=""){return true}var e=n(t);if(e&&e!=""){t.attr("data-fcid",e)}})});a.ajax({type:"POST",url:"/SysBase/FormConfig/GetConfig",data:{PageName:e.pageName},success:function(n){t["isInit"]=true;if(n.error){a.messager.alert("",n.error,"");return}t.isGX=n.isGX;var e=n.config;o(i,e)}})};var o=function(i,o){var n=a.data(i,"formconfig");var e=n.options;var r=a(i);r.find("div.form-group").each(function(i,o){var t=a(o);t.attr("old-title",t.find(">label").text())});if(o!=""){t(i,o)}else{a(i).drawformcard(e.cols)}e.onFirstDraw.call(i)};var t=function(i,o){var t=a.data(i,"formconfig");var n=t.options;var e=a(i);if(o==""){return}var r=a.parseJSON(o);var d=a.grep(r,function(a,i){return a.group=="9999"});a.each(d,function(a,i){e.find('div.form-group[data-fcid="'+i.fcid+'"]').addClass("hidden")});e.find(".fc-column").each(function(i,o){var t=a(o);var n=t.data("fc-column-code");var d=a.grep(r,function(a,i){return a.group==n});for(var i=d.length-1;i>=0;i--){var c=d[i];var l=e.find('div.form-group[data-fcid="'+c.fcid+'"]');if(l.length>0){l.removeClass("hidden");l.find(">label").text(c.title);l.data("colspan",c.colspan);t.prepend(l)}}});a(i).drawformcard(n.cols)};var n=function(a){return a.find(">div>*:eq(0)").attr("id")};var e=function(a){return a.find(">label").text()};var r=function(i,o,t){var n=i.data("fcid");if(!n||n==""){return true}$nv=i.clone();$nv.removeClass("hidden");$nv.addClass("fc-group");$nv.find(">*").wrapAll('<div class="fc-item-content"></div');$nv.find("div.fc-item-content").wrapAll('<div class="fc-item"></div>');a('<div class="fc-item-tag">'+(t+1)+"</div>").prependTo($nv.find(">div.fc-item"));a('<div class="fc-item-edit"><i class="ace-icon fa fa-edit  bigger-120 orange"></i></div>').prependTo($nv.find(">div.fc-item"));var r=i.data("colspan");if(!r||r==""){r=1}$nv.data("formconfig-item",{fcid:n,group:o.data("fcgroup"),title:e(i),colspan:r,iorder:t+1});o.find(">div.row").append($nv)};var d=function(i){var o=a.data(i,"formconfig");var t=o.options;var n=a(i);if(!o.dialog){o.dialog=a('<div class="form-horizontal"><div class="tabbable"><ul class="nav nav-tabs"></ul><div class="tab-content"></div></div></div>').appendTo("body");o.dialog.bs_dialog({width:"lg",title:'<h5 style="margin-top:5px;margin-bottom:5px;"><i class="ace-icon fa fa-cog orange fa-2x" style="margin-right:5px;"></i>表单配置</h5>',buttons:[{dom:'<button class="btn btn-sm btn-warning pull-left"><i class="ace-icon fa  fa-reply-all "></i><span class="">重置</span></button>',handler:function(){a.messager.confirm("确认","确认重置表单配置？",function(i){if(i){o.dialog.bs_dialog("showLoading");a.ajax({type:"POST",url:"/SysBase/FormConfig/ResetConfig",data:{PageName:t.pageName},success:function(i){o.dialog.bs_dialog("hideLoading");if(i.error){a.messager.alert("",i.error,"");return}if(i!=""){a.messager.alert("",i.error,"");return}o.dialog.bs_dialog("close");a.messager.confirm("操作提示","表单配置已经重置,是否刷新重置当前页!",function(a){if(!a){return}location.reload(true)})}})}})}},{dom:'<lable class="pull-left" style="margin-top: 7px; margin-left: 2px;">点栏目右上角图标可设置显示属性，通过前后拖动调整显示顺序，移至其它页签上方调整显示区域。</lable>',handler:function(){}},{dom:'<span btnName="isFormGX" class="'+(ac.isAdmin?" ":"hidden")+'">            <label>                <model class="muted">共享配置</model>                <input class="ace ace-switch ace-switch-5 " name="isFormGX"  type="checkbox" >                <span class="lbl middle"></span>            </label>        </span>',handler:function(){}},{dom:'<button class="btn btn-sm btn-primary mx-xs-quick"><i class="ace-icon fa fa-save "></i><span class="">保存</span></button>',handler:function(){c(i)}}],onShow:function(){a('input[name="isFormGX"]').prop("checked",o.isGX);a("a",o.tabs.find("li")[0]).tab("show")}})}else{}o.tabs=o.dialog.find("ul.nav");o.tabcontent=o.dialog.find("div.tab-content");o.tabs.empty();o.tabcontent.empty();o.columns=[];var e=[];n.find(".fc-column").each(function(i,t){var n=a(t);var d=n.data("fc-column-title");var c=n.data("fc-column-code");var l="fc-item-"+c;o.columns.push({title:d,code:c});o.tabs.append('<li ><a href="#'+l+'" data-toggle="tab" >'+d+"</a></li>");var s=a('<div class="tab-pane fade fc-tabpanel" id="'+l+'" data-fcgroup="'+c+'"><div class="row"></div></div>').appendTo(o.tabcontent);n.find(">div.form-group").each(function(i,o){var t=a(o);if(t.hasClass("hidden")){e.push(t)}else{r(t,s,i)}})});var d="fc-item-9999";o.tabs.append('<li><a href="#'+d+'" data-toggle="tab" >不显示项</a></li>');var l=a('<div class="tab-pane fade fc-tabpanel" id="'+d+'" data-fcgroup="9999"><div class="row"></div></div>').appendTo(o.tabcontent);o.columns.push({title:"不显示项",code:"9999"});a.each(e,function(a,i){r(i,l,a)});o.dialog.find("div.fc-item-edit").unbind(".formconfig").bind("click.formconfig",function(o){var t=a(this).closest("div.fc-group");f(i,t)});o.dialog.find("div.fc-item-content").draggable({revert:true,proxy:function(i){var o=a(i).clone();var t=a('<div class="fc-item-copy"></div>').appendTo(a(i).parent());o.removeClass("fc-item-content");t.append(o);t.outerWidth(a(i).outerWidth());return t},onStartDrag:function(){a(this).draggable("proxy").css("z-index",10)},onStopDrag:function(){a(this).removeAttr("style")}});o.dialog.find("div.fc-group").droppable({onDragEnter:function(i,o){a(o).draggable("options").cursor="auto"},onDragLeave:function(i,o){a(o).draggable("options").cursor="not-allowed"},onDrop:function(o,t){var n=a(t).closest("div.fc-group");a(this).before(n);n.removeAttr("style");s(i)}});o.tabs.find("li").droppable({onDragEnter:function(i,o){a(o).draggable("options").cursor="auto"},onDragLeave:function(i,o){a(o).draggable("options").cursor="not-allowed"},onDrop:function(o,t){var n=a(t).closest("div.fc-group");var e=a(this).find("a").attr("href");a(e).find("div.row").append(n);n.removeAttr("style");var r=n.data("formconfig-item");r.group=a(e).data("fcgroup");s(i)}});o.dialog.bs_dialog("open")};var c=function(i){var o=a.data(i,"formconfig");var n=o.options;var e=a(i);o.dialog.bs_dialog("showLoading","");var r=l(i);var d=a('input[name="isFormGX"]').prop("checked");var c=function(){a.ajax({type:"POST",url:"/SysBase/FormConfig/SaveConfig",data:{PageName:n.pageName,config:r,isGX:d},success:function(n){o.dialog.bs_dialog("hideLoading");if(n.error){a.messager.alert("",n.error,"");return}o.isGX=d;t(i,r);o.dialog.bs_dialog("close")}})};if(!ac.isAdmin&&o.isGX){a.messager.confirm("数据保存","管理员已经共享配置,是否自定义配置?",function(a){if(a){c()}})}else{c()}};var l=function(i){var o=a.data(i,"formconfig");var t=[];o.dialog.find("div.fc-group").each(function(i,o){t.push(a(o).data("formconfig-item"))});return JSON.stringify(t)};var s=function(i){var o=a.data(i,"formconfig");var t=o.options;var n=a(i);if(!o.dialog){return}o.tabcontent.find("div.fc-tabpanel").each(function(i,o){var t=a(o);t.find("div.fc-group").each(function(i,o){var t=a(o);var n=i+1;var e=t.data("formconfig-item");e.iorder=n;t.find("div.fc-item-tag").html(n)})})};var f=function(i,o){var t=a.data(i,"formconfig");var n=t.options;var e=a(i);t.currentItem=o;if(!t["itemdialog"]){t.itemdialog=a('<div class="form-horizontal"><div class="row"><div class="form-group col-sm-12 "><label class="control-label mx-group-title" >显示标题</label><div class="mx-group-control" style="height: 33px;"> <input name="title" class="width-100 mx-input-group"  style="height: 33px;" type="text" /></div> </div><div class="form-group col-sm-12 "><label class="control-label mx-group-title" >显示宽度</label><div class="mx-group-control" style="height: 33px;"> <select name="colspan" class="width-100"><option value="1">跨一列</option><option value="2">跨两列</option><option value="3">跨三列</option></select></div> </div><div class="form-group col-sm-12 "><label class="control-label mx-group-title" >显示区域</label><div class="mx-group-control" style="height: 33px;"> <select name="group" class="width-100"></select></div> </div><div class="form-group col-sm-12 "><label class="control-label mx-group-title" >显示顺序</label><div class="mx-group-control" style="height: 33px;"> <input name="iorder" class="width-100 mx-input-group"  style="height: 33px;" type="text" /></div> </div></div></div>').appendTo("body");var r=t.itemdialog.find('select[name="group"]');a.each(t.columns,function(a,i){r.append('<option value="'+i.code+'">'+i.title+"</option>")});t.itemdialog.bs_dialog({width:"sm",title:'<h5 style="margin-top:5px;margin-bottom:5px;"><i class="ace-icon fa fa-cog orange fa-2x" style="margin-right:5px;"></i><span>显示设置</span></h5>',buttons:[{dom:'<button class="btn btn-sm btn-primary"><i class="ace-icon fa fa-save bigger-110"></i><span class="bigger-110">确定</span></button>',handler:function(){u(i,t.currentItem)}}],onShow:function(){var a=t.currentItem.attr("old-title");if(!a){t.itemdialog.closest("div.modal-content").find("div.modal-header span").text("显示设置");return}t.itemdialog.closest("div.modal-content").find("div.modal-header span").text("显示设置--"+a)}})}var d=o.data("formconfig-item");var c=t.itemdialog.find('input[name="title"]');c.val(d.title);var l=t.itemdialog.find('select[name="colspan"]');l.val(d.colspan);var r=t.itemdialog.find('select[name="group"]');r.val(d.group);var s=t.itemdialog.find('input[name="iorder"]');s.val(d.iorder);t.itemdialog.bs_dialog("open")};var v=function(i,o,t){var n=a.data(i,"formconfig");var e=o.data("formconfig-item");if(e.title!=t){o.find("label.mx-group-title").text(t);e.title=t}};var g=function(i,o,t){var n=a.data(i,"formconfig");var e=o.data("formconfig-item");if(e.group!=t){var r=a("#fc-item-"+t);r.find("div.row").append(o);e.group=t}};var m=function(i,o,t){var n=a.data(i,"formconfig");var e=o.data("formconfig-item");if(e.iorder!=t){var r=a("#fc-item-"+e.group);var d=r.find("div.fc-group");if(t>=d.length+1){r.find("div.row").append(o)}else{a(d[t-1]).before(o)}}};var p=function(i,o,t){var n=a.data(i,"formconfig");var e=o.data("formconfig-item");if(e.colspan!=t){o.data("colspan",t);e.colspan=t;var r="#fc-item-"+e.group;var d=a(r);d.drawformcard(n.options.cols)}};var u=function(i,o){var t=a.data(i,"formconfig");if(!t.itemdialog){t.itemdialog.bs_dialog("close");return}var n=t.options;var e=a(i);var r=t.itemdialog.find('input[name="title"]');var d=t.itemdialog.find('select[name="colspan"]');var c=t.itemdialog.find('select[name="group"]');var l=t.itemdialog.find('input[name="iorder"]');var f={title:r.val(),colspan:d.val(),group:c.val(),iorder:l.val()};if(f.iorder==""){a.messager.alert("","请输入显示顺序！");l.focus();return}if(!a.isNumeric(f.iorder)){a.messager.alert("","显示顺序必须录入为数字！");l.focus();return}var u=o.data("formconfig-item");v(i,o,f.title);g(i,o,f.group);m(i,o,f.iorder);p(i,o,f.colspan);s(i);t.itemdialog.bs_dialog("close")}})(jQuery);